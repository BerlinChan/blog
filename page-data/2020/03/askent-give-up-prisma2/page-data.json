{"componentChunkName":"component---src-templates-post-template-js","path":"/2020/03/askent-give-up-prisma2/","result":{"data":{"markdownRemark":{"id":"38900ee8-d2f2-5e6c-8d01-78b34c1f96b6","html":"<!-- endExcerpt -->\n<h2 id=\"进展\" style=\"position:relative;\"><a href=\"#%E8%BF%9B%E5%B1%95\" aria-label=\"进展 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>进展</h2>\n<p><a href=\"/2020/02/project-askent-admin-audience-client\">继上篇</a>后新完成大屏演示端、消息订阅、部分 API 分页。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 760px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/58005bf63e7a584d2a2a7ee830f22c29/ded7f/askent-wall-and-iphone-mockup.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 57.36842105263158%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC00lEQVR42i2R7WtbZRjGz78gONesbWqb19MkpycvTXqWJufkPelJUmNtFrsmdemW1gmiTHSKiMy1Q7euMDpQO3Fq2dyYH/wzNhjiy1DW4aeVgaLDYr4JP59ztgd+PBcX933dN9xSZHqe9z7c5O33z4v/IitvnMWlmihaneDULG61zKhSekKo+JQCI8E8I+MZnH6DQU+KYV+aA88nkeY7b7HzzVd8/tmn3Lp5na+vfUdEP4JRaqKXW0wXmyTz86RLLXRBWDPxh3PIkRw+NYt3wsAdTOFV0hzyGEhzInDr8hZr6+dYWzvLlas3iBiLBOImcrxGQGwZ1F6wsfR4ooY/ZuKLVvCoJXzhEl61IMLzDPpzSK3uaa5f22Fj4zwXPjnHzrffo5WOYYjtjJlF0pWj5KodstUlMmabdHnBRq8siJqXcSsZBlwJhrwaQ3IBSa/2WN/YZv3iFba2b3DmwlXUTJdI7hjR4gni5VUS5ms28cqq7YVzXRS9LVjk3TOX+Hhzmw/WLuGbbCA55DIDsokjUGdoYo6xyRYh4zhq4SSRyutM1k6hNd6xsXRUeGrhVeRUl1hxha0vfuCjzZ+4/OUv6GYPaShg4oq+iFbpEcsvI0+3CepdJnI9IqWTdkC8+qaNpS1Pza+IuiUSpR637+zy2+5jfrz3CL16AmnAV0RJLTDXOc1M6xT+w0eRkx07VMkeF8ErYqNVG0tbXtDo4tUWCWe77O3tAf/R7/dJzSwjHXTn8UQbHC4vM1VcxhM/gjvewieC/ck246klAqlXbCxtedbQsVgTJd3m/u7v7O/v8/fjf5gWx5QOuDIcdOd4zlPAIVdwKnVGww3R8BKuyaY9wJNoPUFoy3PF5hlWZpG1Jn/8+RfW6//bJ1nsID3jTPLsqC5Cszh8BQ6JIw2OzzAcrOIM1RiZqAtmn1K3PWeoisNfZkytcefuzzx8+Ih7vz4gNNXgfw1qtPa+Sa2xAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/58005bf63e7a584d2a2a7ee830f22c29/5ed05/askent-wall-and-iphone-mockup.webp 190w,\n/static/58005bf63e7a584d2a2a7ee830f22c29/9d76b/askent-wall-and-iphone-mockup.webp 380w,\n/static/58005bf63e7a584d2a2a7ee830f22c29/33466/askent-wall-and-iphone-mockup.webp 760w,\n/static/58005bf63e7a584d2a2a7ee830f22c29/ca244/askent-wall-and-iphone-mockup.webp 1140w,\n/static/58005bf63e7a584d2a2a7ee830f22c29/b0196/askent-wall-and-iphone-mockup.webp 1520w,\n/static/58005bf63e7a584d2a2a7ee830f22c29/35696/askent-wall-and-iphone-mockup.webp 2400w\"\n              sizes=\"(max-width: 760px) 100vw, 760px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/58005bf63e7a584d2a2a7ee830f22c29/253c6/askent-wall-and-iphone-mockup.png 190w,\n/static/58005bf63e7a584d2a2a7ee830f22c29/810ee/askent-wall-and-iphone-mockup.png 380w,\n/static/58005bf63e7a584d2a2a7ee830f22c29/b4918/askent-wall-and-iphone-mockup.png 760w,\n/static/58005bf63e7a584d2a2a7ee830f22c29/c0204/askent-wall-and-iphone-mockup.png 1140w,\n/static/58005bf63e7a584d2a2a7ee830f22c29/54dc9/askent-wall-and-iphone-mockup.png 1520w,\n/static/58005bf63e7a584d2a2a7ee830f22c29/ded7f/askent-wall-and-iphone-mockup.png 2400w\"\n            sizes=\"(max-width: 760px) 100vw, 760px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/58005bf63e7a584d2a2a7ee830f22c29/b4918/askent-wall-and-iphone-mockup.png\"\n            alt=\"大屏演示端界面及观众移动端界面\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<center>大屏演示端界面及观众移动端界面</center>\n<h2 id=\"问题\" style=\"position:relative;\"><a href=\"#%E9%97%AE%E9%A2%98\" aria-label=\"问题 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>问题</h2>\n<p>随着功能开发深入细节，仍在 Preview 开发状态，功能未完善的 ORM 工具 <a href=\"https://github.com/prisma/prisma2\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Prisma2</a> 问题凸显。我对数据库、ORM 没经验，这些问题在之前的选型中确实未考虑到，用到的 <a href=\"https://github.com/prisma-labs/nexus\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Nexus</a> 框架也还在重度开发中，<a href=\"https://github.com/prisma-labs/nexus-prisma/releases/tag/0.10.0\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">经常有 breaking changes</a>，导致项目框架变动频繁，不过 Askent 项目一开始是作为我技术实践学习用的，折腾期间已学到很多。</p>\n<p>开发中的 Prisma2 关键功能严重缺失，导致产品功能无法实现，如今到了要“弃坑”的时候。缺失关键功能如下：</p>\n<ol>\n<li>关联表不支持 column 名自定义</li>\n</ol>\n<p>我的 <code class=\"language-text\">prismal.schema</code> 中有如下 model 定义：</p>\n<div class=\"gatsby-highlight\" data-language=\"graphql\"><pre class=\"language-graphql\"><code class=\"language-graphql\"><span class=\"token property\">model</span> <span class=\"token object\">User</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">id</span>             <span class=\"token scalar\">String</span>     <span class=\"token directive function\">@default</span><span class=\"token punctuation\">(</span><span class=\"token property-query\">cuid</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token directive function\">@id</span>\n  <span class=\"token property\">votedQuestions</span> <span class=\"token property\">Question</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token directive function\">@relation</span><span class=\"token punctuation\">(</span><span class=\"token attr-name\">name</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"VotedUsersUserTable\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token property\">model</span> <span class=\"token object\">Question</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">id</span>           <span class=\"token scalar\">String</span>  <span class=\"token directive function\">@default</span><span class=\"token punctuation\">(</span><span class=\"token property-query\">cuid</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token directive function\">@id</span>\n  <span class=\"token property\">votedUsers</span>   <span class=\"token property\">User</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>  <span class=\"token directive function\">@relation</span><span class=\"token punctuation\">(</span><span class=\"token attr-name\">name</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"VotedUsersUserTable\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">User</code> 和 <code class=\"language-text\">Question</code> 多对多时会创建关联表，用 <code class=\"language-text\">@relation(_name: String?, references: Identifier[]?)</code> <a href=\"https://github.com/prisma/prisma2/blob/master/docs/relations.md/#the-relation-attribute\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">定义关联表名</a>，但无法自定义 field 名，只是无意义的 <code class=\"language-text\">A</code> 和 <code class=\"language-text\">B</code>，如下</p>\n<p>关系表 <code class=\"language-text\">VotedUsersUserTable</code>:</p>\n<table>\n<thead>\n<tr>\n<th>A</th>\n<th>B</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>aId</td>\n<td>bId</td>\n</tr>\n</tbody>\n</table>\n<p>不知道 AB 哪个是 userId，哪个是 questionId，虽然比较一下能确定，但这样也太不明确了，也就不好统计 <code class=\"language-text\">Question.votedUsers</code> 的 <code class=\"language-text\">Count</code>。</p>\n<ol start=\"2\">\n<li>查询排序不支持多条件。详情见 <a href=\"https://github.com/prisma/prisma/issues/62\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">issue: Order by multiple fields</a>。</li>\n<li>不支持 Aggreation 查询。详情见 <a href=\"https://github.com/prisma/prisma-client-js/issues/5\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">issue: Aggregations</a>。</li>\n<li>Count 查询不支持条件。详情见 <a href=\"https://github.com/prisma/prisma-client-js/issues/252\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">issue: Parameterized <code class=\"language-text\">.count()</code> queries</a>。</li>\n</ol>\n<p>这些功能将会在以后逐渐完善，但并没有具体的实践计划，所以为了让 Askent 功能开发继续，暂只能弃坑，准备用成熟的 <a href=\"https://sequelize.org\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Sequelize</a> 替换之，参照 <a href=\"https://github.com/dooboolab/ts-apollo-sequelize\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">ts-apollo-sequelize</a> 项目。</p>\n<p>同时数据库准备用 MySQL 替换 SQLite，之前用 SQLite 是起步之初为简化开发环境。</p>\n<p>我很喜欢 <code class=\"language-text\">prisma.schema</code> 定义 model 的方式，屏蔽麻烦的数据库的建表工作，还有自动生成 <a href=\"https://github.com/prisma/prisma-client-js\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">PrismaClient</a>，极大简化访问数据库操作。看到正在更新的 <a href=\"https://www.nexusjs.org/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Nexus 新官网</a>，将要集成数据库访问，或许就是 <code class=\"language-text\">nexus-prisma</code> 将默认集成到其中，成为从数据库到 GraphQL 的一站式开发框架。很看好 Prisma2 的发展，期待看到它逐渐完善后的样子。</p>","excerpt":"","fields":{"slug":"/2020/03/askent-give-up-prisma2","categorySlugs":["/category/前端/"],"tagSlugs":["/tag/askent/","/tag/orm/","/tag/个人项目/"]},"frontmatter":{"title":"Askent 项目进展及准备弃用 Prisma2","date":"2020-03-01T10:46:37.121Z","categories":["前端"],"description":"完成大屏演示端，随着功能开发深入，仍在 Preview 重度开发的 ORM 工具 Prisma2 问题凸显。我对数据库、ORM 没经验，这些问题在之前的选型中确实未考虑到，准备用成熟的 Sequelize 替换之。","tags":["Askent","ORM","个人项目"],"slug":"/2020/03/askent-give-up-prisma2","featured_media":{"childImageSharp":{"gatsbyImageData":{"layout":"fixed","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAACkElEQVR42i2R60uTYRiH338hqHR5CN3xdXPu5Oaa2zt3ntu0Za5lbtasaQZBGGRf+lBpVJogCpVFJ7GM+tCfURDRiSKjT0lQVCTtW3D1vG89cMGPH/dzPQ/c0mD5JCv37nD92lUePbzP3dXHuJR9hJMFlFSR7kSBQGyQULKIInD6M1icUWRXFLMjgqkjjMEWxGQPscMYRhoQwsWlRaZnLjA9fZ4bt9dwhYexejPI3hzWrn5s/t0aam7z5bB4MpjdaYyOJGZnEpMjLuQxGixRpGJlivurK8zNXWb20gVWHjzBnzxEWPwu3DtMKH2AaLZMJDtCT6ZEKDWkoaSHxMx+DPYe6vU+Gk1+GuU4kpKtMjO3zMyVGywur3F29jaOngqu6CHciSN4U+P4Msc0vOlxrXNGK9iVkmCY02cXuDi/zJnpBcydeSSdnKJezqCz9tHYMUBrZ5H28GEc8Qlc6eN05ibx509pqNktOkf8KHKwgicxxuLNF5ybf8XSrTcomSpSozWD3r0Hf7qKJzaK3F3CplToiFZxJSc0gTd7QkPNaueIjYm5EXzJKk+frfN+/Scv335ByR5BqjcnsAeHGChP0VucxLLrAHKgrEntkcNCPCZ+NK6hZrWzhSuY/MM4IxU2NjaAP9RqNYK9o0h1hhhGd55dqVG6EqMYvfsweIuYhdgSKNEWHMEaPKihZrVTH231FLCHSnxY/8Tm5iY/fv6iWyxT2qbvoc4QZbsxjk5O02zvo8WZFxf2ou8saA8YfcV/iKx2es8gTfZ+ZH+Br9++o57a7xqBRBlpS3OArS2KkEbQmePsEEtqaOulyZaluT3Hzo4+Qf9/+rSuuT2LzpKi1ZHj2fPXfP78hbfvPtLelecvvamRxyrPw/sAAAAASUVORK5CYII="},"images":{"fallback":{"src":"/static/58005bf63e7a584d2a2a7ee830f22c29/ed3fb/askent-wall-and-iphone-mockup.png","srcSet":"/static/58005bf63e7a584d2a2a7ee830f22c29/ed3fb/askent-wall-and-iphone-mockup.png 800w,\n/static/58005bf63e7a584d2a2a7ee830f22c29/779ff/askent-wall-and-iphone-mockup.png 1600w","sizes":"800px"},"sources":[{"srcSet":"/static/58005bf63e7a584d2a2a7ee830f22c29/e7773/askent-wall-and-iphone-mockup.webp 800w,\n/static/58005bf63e7a584d2a2a7ee830f22c29/f2fb1/askent-wall-and-iphone-mockup.webp 1600w","type":"image/webp","sizes":"800px"}]},"width":800,"height":400}}}}},"prevPost":{"fields":{"slug":"/2020/02/game-detention-experience"},"frontmatter":{"title":"看不见的恐怖——游戏《返校》通关感受"}},"nextPost":{"fields":{"slug":"/2020/03/real-time-multi-device-collaboration-devtools"},"frontmatter":{"title":"几款多端实时协作、同步的开发工具"}}},"pageContext":{"slug":"/2020/03/askent-give-up-prisma2","prevPostSlug":"/2020/02/game-detention-experience","nextPostSlug":"/2020/03/real-time-multi-device-collaboration-devtools"}},"staticQueryHashes":["2727970573","3709504828","4110059069"],"slicesMap":{}}