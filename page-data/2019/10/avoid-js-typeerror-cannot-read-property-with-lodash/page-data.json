{"componentChunkName":"component---src-templates-post-template-js","path":"/2019/10/avoid-js-typeerror-cannot-read-property-with-lodash/","result":{"data":{"markdownRemark":{"id":"2e29c034-ef66-5fba-9344-743513c636e3","html":"<!-- endExcerpt -->\n<h2 id=\"问题\" style=\"position:relative;\"><a href=\"#%E9%97%AE%E9%A2%98\" aria-label=\"问题 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>问题</h2>\n<p>在 Javascript 中访问某个对象的属性时，经常会碰到 <code class=\"language-text\">Uncaught TypeError: Cannot read property 'bar' of undefined</code> 错误，例如这样：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> foo\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>foo<span class=\"token punctuation\">.</span>bar<span class=\"token punctuation\">)</span></code></pre></div>\n<p>该问题之常见，以至于在<a href=\"https://juejin.im/post/5a73e3ad5188257a6d63521a\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">6个经典的JavaScript报错分析</a>的统计中位列第一。</p>\n<p>我最常碰到的情况是 API 返回数据结构变化或值为 <code class=\"language-text\">null</code> 时，我不得不小心翼翼地处理它们。</p>\n<h2 id=\"使用--短路\" style=\"position:relative;\"><a href=\"#%E4%BD%BF%E7%94%A8--%E7%9F%AD%E8%B7%AF\" aria-label=\"使用  短路 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>使用 &#x26;&#x26; 短路</h2>\n<p>在有潜在该问题的地方，一直以来我使用 &#x26;&#x26; 短路写法解决。例如访问如下对象：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> modal <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">visibility</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">formData</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'foo'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">config</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">layout</span><span class=\"token operator\">:</span><span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">margin</span><span class=\"token operator\">:</span> <span class=\"token string\">'4px'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>modal<span class=\"token punctuation\">.</span>formData <span class=\"token operator\">&amp;&amp;</span> modal<span class=\"token punctuation\">.</span>formData<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">)</span></code></pre></div>\n<p>因为 <code class=\"language-text\">modal</code> 我能确保它是定义过的对象，但 <code class=\"language-text\">formData</code> 的值可能来自于 API 的返回，所以访问它的下属属性前先判断之，若存在该对象则可访问它的 <code class=\"language-text\">name</code> 属性，否则就<strong>短路</strong>在 <code class=\"language-text\">&amp;&amp;</code> 之前，返回 <code class=\"language-text\">undefined</code> 而不是报错。</p>\n<p>但当对象嵌套多层后这样写就很冗长，比如访问上面对象中的 <code class=\"language-text\">margin</code> 属性，可能会写成这样：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>modal<span class=\"token punctuation\">.</span>config <span class=\"token operator\">&amp;&amp;</span> modal<span class=\"token punctuation\">.</span>config<span class=\"token punctuation\">.</span>layout <span class=\"token operator\">&amp;&amp;</span> modal<span class=\"token punctuation\">.</span>config<span class=\"token punctuation\">.</span>layout<span class=\"token punctuation\">.</span>margin<span class=\"token punctuation\">)</span></code></pre></div>\n<p>事实上我也这样写了很久，虽然不优雅，但是最安全最保险的方法。</p>\n<h2 id=\"使用-lodash\" style=\"position:relative;\"><a href=\"#%E4%BD%BF%E7%94%A8-lodash\" aria-label=\"使用 lodash permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>使用 Lodash</h2>\n<p>对于大型项目可以使用工具库 Lodash 的 get 方法，安全访问深度嵌套的对象，<a href=\"https://lodash.com/docs/4.17.15#get\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">官方示例</a>如下：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> object <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> <span class=\"token string-property property\">'a'</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span> <span class=\"token string-property property\">'b'</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token string-property property\">'c'</span><span class=\"token operator\">:</span> <span class=\"token number\">3</span> <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n \n_<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>object<span class=\"token punctuation\">,</span> <span class=\"token string\">'a[0].b.c'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// => 3</span>\n \n_<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>object<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'a'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'0'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'b'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'c'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// => 3</span>\n \n_<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>object<span class=\"token punctuation\">,</span> <span class=\"token string\">'a.b.c'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'default'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// => 'default'</span></code></pre></div>\n<p>这样就不会有短路写法一长串的 <code class=\"language-text\">&amp;&amp;</code> 了，最近将本博客中很多短路写法都换成该方法。<a href=\"https://ramdajs.com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Ramda.js</a> 中的 path 方法也能实现同样功能。阮一峰更推荐这个库，原因看他的文章《<a href=\"http://www.ruanyifeng.com/blog/2017/03/ramda.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Ramda 函数库参考教程</a>》</p>\n<h2 id=\"参考\" style=\"position:relative;\"><a href=\"#%E5%8F%82%E8%80%83\" aria-label=\"参考 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>参考</h2>\n<p><a href=\"https://juejin.im/post/5c810170e51d450a453fb48e\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">[译] 避免那些可恶的 “cannot read property of undefined” 错误</a>(<a href=\"https://css-tricks.com/%E2%80%8B%E2%80%8Bavoiding-those-dang-cannot-read-property-of-undefined-errors/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">英文原文</a>)</p>\n<p><a href=\"https://juejin.im/post/5a73e3ad5188257a6d63521a\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">6个经典的JavaScript报错分析</a></p>\n<p><a href=\"http://www.ruanyifeng.com/blog/2017/03/ramda.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Ramda 函数库参考教程</a></p>","excerpt":"","fields":{"slug":"/2019/10/avoid-js-typeerror-cannot-read-property-with-lodash","categorySlugs":["/category/前端/"],"tagSlugs":["/tag/javascript/"]},"frontmatter":{"title":"使用 Lodash 避免 TypeError Cannot read property 错误","date":"2019-10-08T10:46:37.121Z","categories":["前端"],"description":"JS 中访问某个对象的属性时，经常会碰到 Uncaught TypeError: Cannot read property 错误，短路 && 写法简单安全但不优雅，工具库 Lodash 的 get 方法是个替代方法。","tags":["Javascript"],"slug":"/2019/10/avoid-js-typeerror-cannot-read-property-with-lodash","featured_media":{"childImageSharp":{"gatsbyImageData":{"layout":"fixed","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA7klEQVR42mP4cNsfE72/5Y9VHA0xYNX55X7AxzsQtt/bG37EaobovHbY/cUVH6D+bw8C/zwL/nQ3gCjNQHv+vwjpadC7sNcVqO3ENqd5E0yeX/IB6n9PtGb9O6e9X17z72003L3GYWqn0b/nwZjux6b5ZUhfve7GOfrntlvMaFPbOFdvyRTDP89C3t4kpPndrYBfD322bY3PbS3pm18xd11tZX/lhbNZ3+55v78VQCjAbgd8ueN962rWvnNd+8+07DvVsvdM19WLWV/uegOliIgqsP7vd11/3HMDI9ev2HRi1wxGAUBHwtGH29ijCgDVqJja5x/qtQAAAABJRU5ErkJggg=="},"images":{"fallback":{"src":"/static/f462468318d7f058643650a847b8e1f5/ed3fb/avoid-js-typeerror-cannot-read-property-with-lodash.png","srcSet":"/static/f462468318d7f058643650a847b8e1f5/ed3fb/avoid-js-typeerror-cannot-read-property-with-lodash.png 800w","sizes":"800px"},"sources":[{"srcSet":"/static/f462468318d7f058643650a847b8e1f5/e7773/avoid-js-typeerror-cannot-read-property-with-lodash.webp 800w","type":"image/webp","sizes":"800px"}]},"width":800,"height":400}}}}},"prevPost":{"fields":{"slug":"/2019/09/piano-solo-time-to-say-goodbye"},"frontmatter":{"title":"钢琴独奏 - Time To Say Goodbye"}},"nextPost":{"fields":{"slug":"/2019/10/food-price-increase"},"frontmatter":{"title":"武汉物价飞涨早点吃不起了"}}},"pageContext":{"slug":"/2019/10/avoid-js-typeerror-cannot-read-property-with-lodash","prevPostSlug":"/2019/09/piano-solo-time-to-say-goodbye","nextPostSlug":"/2019/10/food-price-increase"}},"staticQueryHashes":["2727970573","3709504828","4110059069"],"slicesMap":{}}