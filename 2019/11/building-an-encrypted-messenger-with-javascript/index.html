<!DOCTYPE html><html lang="zh-Hans" prefix="og: http://ogp.me/ns#"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-43244265-2"></script><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="generator" content="Gatsby 5.16.0"/><meta name="theme-color" content="#ff5722"/><meta name="description" content="译文。通过用 Node、Javascript 实现一个端到端加密聊天程序，解释非对称加密 RSA 如何工作以及如何使用。" data-gatsby-head="true"/><meta property="og:url" content="https://www.berlinchan.com/2019/11/building-an-encrypted-messenger-with-javascript" data-gatsby-head="true"/><meta property="og:site_name" content="陈柏林的Blog" data-gatsby-head="true"/><meta property="og:type" content="article" data-gatsby-head="true"/><meta property="article:author" content="陈柏林" data-gatsby-head="true"/><meta property="og:title" content="在 Javascript 中使用公钥加密的介绍 | 陈柏林的Blog" data-gatsby-head="true"/><meta property="og:description" content="译文。通过用 Node、Javascript 实现一个端到端加密聊天程序，解释非对称加密 RSA 如何工作以及如何使用。" data-gatsby-head="true"/><meta property="og:image" content="https://www.berlinchan.com/static/75a63a7e3d884a756bc9835c73bb3add/e737e/Matrix.jpg" data-gatsby-head="true"/><meta property="og:image:secure_url" content="https://www.berlinchan.com/static/75a63a7e3d884a756bc9835c73bb3add/e737e/Matrix.jpg" data-gatsby-head="true"/><meta property="og:image:width" content="800" data-gatsby-head="true"/><meta property="og:image:height" content="400" data-gatsby-head="true"/><meta name="twitter:card" content="summary_large_image" data-gatsby-head="true"/><meta name="twitter:site" content="@BerlinChanCom" data-gatsby-head="true"/><meta name="twitter:creator" content="@BerlinChanCom" data-gatsby-head="true"/><link rel="alternate" type="application/rss+xml" title="陈柏林的Blog RSS Feed" href="/rss.xml"/><link rel="preconnect" href="https://www.googletagmanager.com"/><link rel="dns-prefetch" href="https://www.googletagmanager.com"/><link rel="sitemap" type="application/xml" href="/sitemap-index.xml"/><link rel="icon" href="/favicon-32x32.png?v=d08587432fd7f864e0b9d6f9a08966e2" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=d08587432fd7f864e0b9d6f9a08966e2"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=d08587432fd7f864e0b9d6f9a08966e2"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=d08587432fd7f864e0b9d6f9a08966e2"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=d08587432fd7f864e0b9d6f9a08966e2"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=d08587432fd7f864e0b9d6f9a08966e2"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=d08587432fd7f864e0b9d6f9a08966e2"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=d08587432fd7f864e0b9d6f9a08966e2"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=d08587432fd7f864e0b9d6f9a08966e2"/><title data-gatsby-head="true">在 Javascript 中使用公钥加密的介绍 - 陈柏林的Blog</title><style data-href="/styles.bedf8497fbfd7791aaf5.css" data-identity="gatsby-global-css">code[class*=language-],pre[class*=language-]{word-wrap:normal;background:none;color:#f8f8f2;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;-webkit-hyphens:none;hyphens:none;line-height:1.5;tab-size:4;text-align:left;text-shadow:0 1px rgba(0,0,0,.3);white-space:pre;word-break:normal;word-spacing:normal}pre[class*=language-]{border-radius:.3em;margin:.5em 0;overflow:auto;padding:1em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#272822}:not(pre)>code[class*=language-]{border-radius:.3em;padding:.1em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#8292a2}.token.punctuation{color:#f8f8f2}.token.namespace{opacity:.7}.token.constant,.token.deleted,.token.property,.token.symbol,.token.tag{color:#f92672}.token.boolean,.token.number{color:#ae81ff}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#a6e22e}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url,.token.variable{color:#f8f8f2}.token.atrule,.token.attr-value,.token.class-name,.token.function{color:#e6db74}.token.keyword{color:#66d9ef}.token.important,.token.regex{color:#fd971f}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}@media (prefers-color-scheme:dark){.markdown-body{--color-prettylights-syntax-comment:#8b949e;--color-prettylights-syntax-constant:#79c0ff;--color-prettylights-syntax-entity:#d2a8ff;--color-prettylights-syntax-storage-modifier-import:#c9d1d9;--color-prettylights-syntax-entity-tag:#7ee787;--color-prettylights-syntax-keyword:#ff7b72;--color-prettylights-syntax-string:#a5d6ff;--color-prettylights-syntax-variable:#ffa657;--color-prettylights-syntax-brackethighlighter-unmatched:#f85149;--color-prettylights-syntax-invalid-illegal-text:#f0f6fc;--color-prettylights-syntax-invalid-illegal-bg:#8e1519;--color-prettylights-syntax-carriage-return-text:#f0f6fc;--color-prettylights-syntax-carriage-return-bg:#b62324;--color-prettylights-syntax-string-regexp:#7ee787;--color-prettylights-syntax-markup-list:#f2cc60;--color-prettylights-syntax-markup-heading:#1f6feb;--color-prettylights-syntax-markup-italic:#c9d1d9;--color-prettylights-syntax-markup-bold:#c9d1d9;--color-prettylights-syntax-markup-deleted-text:#ffdcd7;--color-prettylights-syntax-markup-deleted-bg:#67060c;--color-prettylights-syntax-markup-inserted-text:#aff5b4;--color-prettylights-syntax-markup-inserted-bg:#033a16;--color-prettylights-syntax-markup-changed-text:#ffdfb6;--color-prettylights-syntax-markup-changed-bg:#5a1e02;--color-prettylights-syntax-markup-ignored-text:#c9d1d9;--color-prettylights-syntax-markup-ignored-bg:#1158c7;--color-prettylights-syntax-meta-diff-range:#d2a8ff;--color-prettylights-syntax-brackethighlighter-angle:#8b949e;--color-prettylights-syntax-sublimelinter-gutter-mark:#484f58;--color-prettylights-syntax-constant-other-reference-link:#a5d6ff;--color-fg-default:#c9d1d9;--color-fg-muted:#8b949e;--color-fg-subtle:#484f58;--color-canvas-default:#0d1117;--color-canvas-subtle:#161b22;--color-border-default:#30363d;--color-border-muted:#21262d;--color-neutral-muted:rgba(110,118,129,0.4);--color-accent-fg:#58a6ff;--color-accent-emphasis:#1f6feb;--color-attention-subtle:rgba(187,128,9,0.15);--color-danger-fg:#f85149;color-scheme:dark}}@media (prefers-color-scheme:light){.markdown-body{--color-prettylights-syntax-comment:#6e7781;--color-prettylights-syntax-constant:#0550ae;--color-prettylights-syntax-entity:#8250df;--color-prettylights-syntax-storage-modifier-import:#24292f;--color-prettylights-syntax-entity-tag:#116329;--color-prettylights-syntax-keyword:#cf222e;--color-prettylights-syntax-string:#0a3069;--color-prettylights-syntax-variable:#953800;--color-prettylights-syntax-brackethighlighter-unmatched:#82071e;--color-prettylights-syntax-invalid-illegal-text:#f6f8fa;--color-prettylights-syntax-invalid-illegal-bg:#82071e;--color-prettylights-syntax-carriage-return-text:#f6f8fa;--color-prettylights-syntax-carriage-return-bg:#cf222e;--color-prettylights-syntax-string-regexp:#116329;--color-prettylights-syntax-markup-list:#3b2300;--color-prettylights-syntax-markup-heading:#0550ae;--color-prettylights-syntax-markup-italic:#24292f;--color-prettylights-syntax-markup-bold:#24292f;--color-prettylights-syntax-markup-deleted-text:#82071e;--color-prettylights-syntax-markup-deleted-bg:#ffebe9;--color-prettylights-syntax-markup-inserted-text:#116329;--color-prettylights-syntax-markup-inserted-bg:#dafbe1;--color-prettylights-syntax-markup-changed-text:#953800;--color-prettylights-syntax-markup-changed-bg:#ffd8b5;--color-prettylights-syntax-markup-ignored-text:#eaeef2;--color-prettylights-syntax-markup-ignored-bg:#0550ae;--color-prettylights-syntax-meta-diff-range:#8250df;--color-prettylights-syntax-brackethighlighter-angle:#57606a;--color-prettylights-syntax-sublimelinter-gutter-mark:#8c959f;--color-prettylights-syntax-constant-other-reference-link:#0a3069;--color-fg-default:#24292f;--color-fg-muted:#57606a;--color-fg-subtle:#6e7781;--color-canvas-default:#fff;--color-canvas-subtle:#f6f8fa;--color-border-default:#d0d7de;--color-border-muted:#d8dee4;--color-neutral-muted:rgba(175,184,193,0.2);--color-accent-fg:#0969da;--color-accent-emphasis:#0969da;--color-attention-subtle:#fff8c5;--color-danger-fg:#cf222e;color-scheme:light}}.markdown-body{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;word-wrap:break-word;background-color:var(--color-canvas-default);color:var(--color-fg-default);font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji;font-size:16px;line-height:1.5;margin:0}.markdown-body h1:hover .anchor .octicon-link:before,.markdown-body h2:hover .anchor .octicon-link:before,.markdown-body h3:hover .anchor .octicon-link:before,.markdown-body h4:hover .anchor .octicon-link:before,.markdown-body h5:hover .anchor .octicon-link:before,.markdown-body h6:hover .anchor .octicon-link:before{background-color:currentColor;content:" ";display:inline-block;height:16px;-webkit-mask-image:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 0 0 1.06 1.06l1.25-1.25a2 2 0 1 1 2.83 2.83l-2.5 2.5a2 2 0 0 1-2.83 0 .75.75 0 0 0-1.06 1.06 3.5 3.5 0 0 0 4.95 0l2.5-2.5a3.5 3.5 0 0 0-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 0 1 0-2.83l2.5-2.5a2 2 0 0 1 2.83 0 .75.75 0 0 0 1.06-1.06 3.5 3.5 0 0 0-4.95 0l-2.5 2.5a3.5 3.5 0 0 0 4.95 4.95l1.25-1.25a.75.75 0 0 0-1.06-1.06l-1.25 1.25a2 2 0 0 1-2.83 0z"/></svg>');mask-image:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 0 0 1.06 1.06l1.25-1.25a2 2 0 1 1 2.83 2.83l-2.5 2.5a2 2 0 0 1-2.83 0 .75.75 0 0 0-1.06 1.06 3.5 3.5 0 0 0 4.95 0l2.5-2.5a3.5 3.5 0 0 0-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 0 1 0-2.83l2.5-2.5a2 2 0 0 1 2.83 0 .75.75 0 0 0 1.06-1.06 3.5 3.5 0 0 0-4.95 0l-2.5 2.5a3.5 3.5 0 0 0 4.95 4.95l1.25-1.25a.75.75 0 0 0-1.06-1.06l-1.25 1.25a2 2 0 0 1-2.83 0z"/></svg>');width:16px}.markdown-body details,.markdown-body figcaption,.markdown-body figure{display:block}.markdown-body summary{display:list-item}.markdown-body [hidden]{display:none!important}.markdown-body a{background-color:transparent;color:var(--color-accent-fg);text-decoration:none}.markdown-body a:active,.markdown-body a:hover{outline-width:0}.markdown-body abbr[title]{border-bottom:none;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}.markdown-body b,.markdown-body strong{font-weight:600}.markdown-body dfn{font-style:italic}.markdown-body h1{border-bottom:1px solid var(--color-border-muted);font-size:2em;font-weight:600;margin:.67em 0;padding-bottom:.3em}.markdown-body mark{background-color:var(--color-attention-subtle);color:var(--color-text-primary)}.markdown-body small{font-size:90%}.markdown-body sub,.markdown-body sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}.markdown-body sub{bottom:-.25em}.markdown-body sup{top:-.5em}.markdown-body img{background-color:var(--color-canvas-default);border-style:none;box-sizing:content-box;max-width:100%}.markdown-body code,.markdown-body kbd,.markdown-body pre,.markdown-body samp{font-family:monospace,monospace;font-size:1em}.markdown-body figure{margin:1em 40px}.markdown-body hr{background:transparent;background-color:var(--color-border-default);border:0;box-sizing:content-box;height:.25em;margin:24px 0;overflow:hidden;padding:0}.markdown-body input{font:inherit;font-family:inherit;font-size:inherit;line-height:inherit;margin:0;overflow:visible}.markdown-body [type=button],.markdown-body [type=reset],.markdown-body [type=submit]{-webkit-appearance:button}.markdown-body [type=button]::-moz-focus-inner,.markdown-body [type=reset]::-moz-focus-inner,.markdown-body [type=submit]::-moz-focus-inner{border-style:none;padding:0}.markdown-body [type=button]:-moz-focusring,.markdown-body [type=reset]:-moz-focusring,.markdown-body [type=submit]:-moz-focusring{outline:1px dotted ButtonText}.markdown-body [type=checkbox],.markdown-body [type=radio]{box-sizing:border-box;padding:0}.markdown-body [type=number]::-webkit-inner-spin-button,.markdown-body [type=number]::-webkit-outer-spin-button{height:auto}.markdown-body [type=search]{-webkit-appearance:textfield;outline-offset:-2px}.markdown-body [type=search]::-webkit-search-cancel-button,.markdown-body [type=search]::-webkit-search-decoration{-webkit-appearance:none}.markdown-body ::-webkit-input-placeholder{color:inherit;opacity:.54}.markdown-body ::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}.markdown-body a:hover{text-decoration:underline}.markdown-body hr:after,.markdown-body hr:before{content:"";display:table}.markdown-body hr:after{clear:both}.markdown-body table{border-collapse:collapse;border-spacing:0;display:block;max-width:100%;overflow:auto;width:max-content}.markdown-body td,.markdown-body th{padding:0}.markdown-body details summary{cursor:pointer}.markdown-body details:not([open])>:not(summary){display:none!important}.markdown-body kbd{background-color:var(--color-canvas-subtle);border-bottom-color:var(--color-neutral-muted);border:1px solid var(--color-neutral-muted);border-radius:6px;box-shadow:inset 0 -1px 0 var(--color-neutral-muted);color:var(--color-fg-default);display:inline-block;font:11px ui-monospace,SFMono-Regular,SF Mono,Menlo,Consolas,Liberation Mono,monospace;line-height:10px;padding:3px 5px;vertical-align:middle}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{font-weight:600;line-height:1.25;margin-bottom:16px;margin-top:24px}.markdown-body h2{border-bottom:1px solid var(--color-border-muted);font-size:1.5em;font-weight:600;padding-bottom:.3em}.markdown-body h3{font-size:1.25em;font-weight:600}.markdown-body h4{font-size:1em;font-weight:600}.markdown-body h5{font-size:.875em;font-weight:600}.markdown-body h6{color:var(--color-fg-muted);font-size:.85em;font-weight:600}.markdown-body p{margin-bottom:10px;margin-top:0}.markdown-body blockquote{border-left:.25em solid var(--color-border-default);color:var(--color-fg-muted);margin:0;padding:0 1em}.markdown-body ol,.markdown-body ul{margin-bottom:0;margin-top:0;padding-left:2em}.markdown-body ol ol,.markdown-body ul ol{list-style-type:lower-roman}.markdown-body ol ol ol,.markdown-body ol ul ol,.markdown-body ul ol ol,.markdown-body ul ul ol{list-style-type:lower-alpha}.markdown-body dd{margin-left:0}.markdown-body code,.markdown-body pre,.markdown-body tt{font-family:ui-monospace,SFMono-Regular,SF Mono,Menlo,Consolas,Liberation Mono,monospace;font-size:12px}.markdown-body pre{word-wrap:normal;margin-bottom:0;margin-top:0}.markdown-body .octicon{fill:currentColor;display:inline-block;overflow:visible!important;vertical-align:text-bottom}.markdown-body ::placeholder{color:var(--color-fg-subtle);opacity:1}.markdown-body input::-webkit-inner-spin-button,.markdown-body input::-webkit-outer-spin-button{appearance:none;margin:0}.markdown-body .pl-c{color:var(--color-prettylights-syntax-comment)}.markdown-body .pl-c1,.markdown-body .pl-s .pl-v{color:var(--color-prettylights-syntax-constant)}.markdown-body .pl-e,.markdown-body .pl-en{color:var(--color-prettylights-syntax-entity)}.markdown-body .pl-s .pl-s1,.markdown-body .pl-smi{color:var(--color-prettylights-syntax-storage-modifier-import)}.markdown-body .pl-ent{color:var(--color-prettylights-syntax-entity-tag)}.markdown-body .pl-k{color:var(--color-prettylights-syntax-keyword)}.markdown-body .pl-pds,.markdown-body .pl-s,.markdown-body .pl-s .pl-pse .pl-s1,.markdown-body .pl-sr,.markdown-body .pl-sr .pl-cce,.markdown-body .pl-sr .pl-sra,.markdown-body .pl-sr .pl-sre{color:var(--color-prettylights-syntax-string)}.markdown-body .pl-smw,.markdown-body .pl-v{color:var(--color-prettylights-syntax-variable)}.markdown-body .pl-bu{color:var(--color-prettylights-syntax-brackethighlighter-unmatched)}.markdown-body .pl-ii{background-color:var(--color-prettylights-syntax-invalid-illegal-bg);color:var(--color-prettylights-syntax-invalid-illegal-text)}.markdown-body .pl-c2{background-color:var(--color-prettylights-syntax-carriage-return-bg);color:var(--color-prettylights-syntax-carriage-return-text)}.markdown-body .pl-sr .pl-cce{color:var(--color-prettylights-syntax-string-regexp);font-weight:700}.markdown-body .pl-ml{color:var(--color-prettylights-syntax-markup-list)}.markdown-body .pl-mh,.markdown-body .pl-mh .pl-en,.markdown-body .pl-ms{color:var(--color-prettylights-syntax-markup-heading);font-weight:700}.markdown-body .pl-mi{color:var(--color-prettylights-syntax-markup-italic);font-style:italic}.markdown-body .pl-mb{color:var(--color-prettylights-syntax-markup-bold);font-weight:700}.markdown-body .pl-md{background-color:var(--color-prettylights-syntax-markup-deleted-bg);color:var(--color-prettylights-syntax-markup-deleted-text)}.markdown-body .pl-mi1{background-color:var(--color-prettylights-syntax-markup-inserted-bg);color:var(--color-prettylights-syntax-markup-inserted-text)}.markdown-body .pl-mc{background-color:var(--color-prettylights-syntax-markup-changed-bg);color:var(--color-prettylights-syntax-markup-changed-text)}.markdown-body .pl-mi2{background-color:var(--color-prettylights-syntax-markup-ignored-bg);color:var(--color-prettylights-syntax-markup-ignored-text)}.markdown-body .pl-mdr{color:var(--color-prettylights-syntax-meta-diff-range);font-weight:700}.markdown-body .pl-ba{color:var(--color-prettylights-syntax-brackethighlighter-angle)}.markdown-body .pl-sg{color:var(--color-prettylights-syntax-sublimelinter-gutter-mark)}.markdown-body .pl-corl{color:var(--color-prettylights-syntax-constant-other-reference-link);text-decoration:underline}.markdown-body [data-catalyst]{display:block}.markdown-body g-emoji{font-family:Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol;font-size:1em;font-style:normal!important;font-weight:400;line-height:1;vertical-align:-.075em}.markdown-body g-emoji img{height:1em;width:1em}.markdown-body:after,.markdown-body:before{content:"";display:table}.markdown-body:after{clear:both}.markdown-body>:first-child{margin-top:0!important}.markdown-body>:last-child{margin-bottom:0!important}.markdown-body a:not([href]){color:inherit;text-decoration:none}.markdown-body .absent{color:var(--color-danger-fg)}.markdown-body .anchor{float:left;line-height:1;margin-left:-20px;padding-right:4px}.markdown-body .anchor:focus{outline:none}.markdown-body blockquote,.markdown-body details,.markdown-body dl,.markdown-body ol,.markdown-body p,.markdown-body pre,.markdown-body table,.markdown-body ul{margin-bottom:16px;margin-top:0}.markdown-body blockquote>:first-child{margin-top:0}.markdown-body blockquote>:last-child{margin-bottom:0}.markdown-body sup>a:before{content:"["}.markdown-body sup>a:after{content:"]"}.markdown-body h1 .octicon-link,.markdown-body h2 .octicon-link,.markdown-body h3 .octicon-link,.markdown-body h4 .octicon-link,.markdown-body h5 .octicon-link,.markdown-body h6 .octicon-link{color:var(--color-fg-default);vertical-align:middle;visibility:hidden}.markdown-body h1:hover .anchor,.markdown-body h2:hover .anchor,.markdown-body h3:hover .anchor,.markdown-body h4:hover .anchor,.markdown-body h5:hover .anchor,.markdown-body h6:hover .anchor{text-decoration:none}.markdown-body h1:hover .anchor .octicon-link,.markdown-body h2:hover .anchor .octicon-link,.markdown-body h3:hover .anchor .octicon-link,.markdown-body h4:hover .anchor .octicon-link,.markdown-body h5:hover .anchor .octicon-link,.markdown-body h6:hover .anchor .octicon-link{visibility:visible}.markdown-body h1 code,.markdown-body h1 tt,.markdown-body h2 code,.markdown-body h2 tt,.markdown-body h3 code,.markdown-body h3 tt,.markdown-body h4 code,.markdown-body h4 tt,.markdown-body h5 code,.markdown-body h5 tt,.markdown-body h6 code,.markdown-body h6 tt{font-size:inherit;padding:0 .2em}.markdown-body ol.no-list,.markdown-body ul.no-list{list-style-type:none;padding:0}.markdown-body ol[type="1"]{list-style-type:decimal}.markdown-body ol[type=a]{list-style-type:lower-alpha}.markdown-body ol[type=i]{list-style-type:lower-roman}.markdown-body div>ol:not([type]){list-style-type:decimal}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-bottom:0;margin-top:0}.markdown-body li>p{margin-top:16px}.markdown-body li+li{margin-top:.25em}.markdown-body dl{padding:0}.markdown-body dl dt{font-size:1em;font-style:italic;font-weight:600;margin-top:16px;padding:0}.markdown-body dl dd{margin-bottom:16px;padding:0 16px}.markdown-body table th{font-weight:600}.markdown-body table td,.markdown-body table th{border:1px solid var(--color-border-default);padding:6px 13px}.markdown-body table tr{background-color:var(--color-canvas-default);border-top:1px solid var(--color-border-muted)}.markdown-body table tr:nth-child(2n){background-color:var(--color-canvas-subtle)}.markdown-body table img{background-color:transparent}.markdown-body img[align=right]{padding-left:20px}.markdown-body img[align=left]{padding-right:20px}.markdown-body .emoji{background-color:transparent;max-width:none;vertical-align:text-top}.markdown-body span.frame{display:block;overflow:hidden}.markdown-body span.frame>span{border:1px solid var(--color-border-default);display:block;float:left;margin:13px 0 0;overflow:hidden;padding:7px;width:auto}.markdown-body span.frame span img{display:block;float:left}.markdown-body span.frame span span{clear:both;color:var(--color-fg-default);display:block;padding:5px 0 0}.markdown-body span.align-center{clear:both;display:block;overflow:hidden}.markdown-body span.align-center>span{display:block;margin:13px auto 0;overflow:hidden;text-align:center}.markdown-body span.align-center span img{margin:0 auto;text-align:center}.markdown-body span.align-right{clear:both;display:block;overflow:hidden}.markdown-body span.align-right>span{display:block;margin:13px 0 0;overflow:hidden;text-align:right}.markdown-body span.align-right span img{margin:0;text-align:right}.markdown-body span.float-left{display:block;float:left;margin-right:13px;overflow:hidden}.markdown-body span.float-left span{margin:13px 0 0}.markdown-body span.float-right{display:block;float:right;margin-left:13px;overflow:hidden}.markdown-body span.float-right>span{display:block;margin:13px auto 0;overflow:hidden;text-align:right}.markdown-body code,.markdown-body tt{background-color:var(--color-neutral-muted);border-radius:6px;font-size:85%;margin:0;padding:.2em .4em}.markdown-body code br,.markdown-body tt br{display:none}.markdown-body del code{text-decoration:inherit}.markdown-body pre code{font-size:100%}.markdown-body pre>code{background:transparent;border:0;margin:0;padding:0;white-space:pre;word-break:normal}.markdown-body .highlight{margin-bottom:16px}.markdown-body .highlight pre{margin-bottom:0;word-break:normal}.markdown-body .highlight pre,.markdown-body pre{border-radius:6px;font-size:85%;line-height:1.45;overflow:auto;padding:16px}.markdown-body pre code,.markdown-body pre tt{word-wrap:normal;background-color:transparent;border:0;display:inline;line-height:inherit;margin:0;max-width:auto;overflow:visible;padding:0}.markdown-body .csv-data td,.markdown-body .csv-data th{font-size:12px;line-height:1;overflow:hidden;padding:5px;text-align:left;white-space:nowrap}.markdown-body .csv-data .blob-num{background:var(--color-canvas-default);border:0;padding:10px 8px 9px;text-align:right}.markdown-body .csv-data tr{border-top:0}.markdown-body .csv-data th{background:var(--color-canvas-subtle);border-top:0;font-weight:600}.markdown-body .footnotes{border-top:1px solid var(--color-border-default);color:var(--color-fg-muted);font-size:12px}.markdown-body .footnotes ol{padding-left:16px}.markdown-body .footnotes li{position:relative}.markdown-body .footnotes li:target:before{border:2px solid var(--color-accent-emphasis);border-radius:6px;bottom:-8px;content:"";left:-24px;pointer-events:none;position:absolute;right:-8px;top:-8px}.markdown-body .footnotes li:target{color:var(--color-fg-default)}.markdown-body .footnotes .data-footnote-backref g-emoji{font-family:monospace}.markdown-body .task-list-item{list-style-type:none}.markdown-body .task-list-item label{font-weight:400}.markdown-body .task-list-item.enabled label{cursor:pointer}.markdown-body .task-list-item+.task-list-item{margin-top:3px}.markdown-body .task-list-item .handle{display:none}.markdown-body .task-list-item-checkbox{margin:0 .2em .25em -1.6em;vertical-align:middle}.markdown-body .contains-task-list:dir(rtl) .task-list-item-checkbox{margin:0 -1.6em .25em .2em}.markdown-body ::-webkit-calendar-picker-indicator{filter:invert(50%)}</style><style data-emotion="css-global 0"></style><style data-emotion="css-global o6gwfi">html{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;box-sizing:border-box;-webkit-text-size-adjust:100%;}*,*::before,*::after{box-sizing:inherit;}strong,b{font-weight:700;}body{margin:0;color:rgba(0, 0, 0, 0.87);font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:1rem;line-height:1.5;letter-spacing:0.00938em;background-color:#fff;}@media print{body{background-color:#fff;}}body::backdrop{background-color:#fff;}</style><style data-emotion="css 1c0c9m2 784rfr 1972fda 9lpcve ughsol 2wdn9 84nudp pz8mrn 4rxpbg 1hiehca 19v1jgj rcl8vx 9wvnva 9yvo9k 1vyu5pa 1x6h7g1 yjjqr3 68xjr0 1e0j580 16820zy 1yuhvjn wwkjos qbwvub 13dgk6d 1cef0gz hkx3jt q7mezt 1ebprri hibhi5 1n5khr6 1ubjslf 20tnkx 199nrdm fhbwnz 18b9ajk penf9g xz9haa 15zfxqh tzdv1b 16d0jw 177xvbk 1rfyg05 18q3puk 1pdhekk deih4v 14ecud3 2zp2ut osloyf">.css-1c0c9m2{background-color:#fff;color:rgba(0, 0, 0, 0.87);-webkit-transition:box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;box-shadow:var(--Paper-shadow);background-image:var(--Paper-overlay);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;width:100%;box-sizing:border-box;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;position:fixed;z-index:1100;top:0;left:auto;right:0;--AppBar-background:#f5f5f5;--AppBar-color:rgba(0, 0, 0, 0.87);background-color:var(--AppBar-background);color:var(--AppBar-color);}@media print{.css-1c0c9m2{position:absolute;}}.css-784rfr{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding-left:16px;padding-right:16px;min-height:56px;border-bottom:1px solid rgba(0, 0, 0, 0.12);}@media (min-width:600px){.css-784rfr{padding-left:24px;padding-right:24px;}}@media (min-width:0px){@media (orientation: landscape){.css-784rfr{min-height:48px;}}}@media (min-width:600px){.css-784rfr{min-height:64px;}}.css-1972fda{margin:0;font:inherit;line-height:inherit;letter-spacing:inherit;color:#ff5722;-webkit-text-decoration:underline;text-decoration:underline;text-decoration-color:var(--Link-underlineColor);--Link-underlineColor:rgba(255, 87, 34, 0.4);margin-right:16px;}.css-1972fda:hover{text-decoration-color:inherit;}.css-9lpcve{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;width:40px;height:40px;font-family:"Roboto","Helvetica","Arial",sans-serif;font-size:1.25rem;line-height:1;border-radius:50%;overflow:hidden;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;color:#fff;background-color:#bdbdbd;}.css-ughsol{margin:0;font:inherit;line-height:inherit;letter-spacing:inherit;color:#ff5722;-webkit-text-decoration:none;text-decoration:none;color:#ff5722;}.css-2wdn9{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:1.25rem;line-height:1.334;letter-spacing:0em;text-align:var(--Typography-textAlign);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;color:inherit;}@media (min-width:600px){.css-2wdn9{font-size:1.3118rem;}}@media (min-width:900px){.css-2wdn9{font-size:1.4993rem;}}@media (min-width:1200px){.css-2wdn9{font-size:1.4993rem;}}.css-84nudp{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin-left:auto;}.css-pz8mrn .MenuComponent-menuDropdown{width:200px;}.css-pz8mrn .MenuComponent-menuLink{width:100%;}.css-pz8mrn .MenuComponent-toolbarLink{padding:8px;}.css-pz8mrn .MenuComponent-activeLink{color:rgba(0, 0, 0, 0.54);}.css-4rxpbg{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:1rem;line-height:1.5;letter-spacing:0.00938em;color:#ff5722;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;-webkit-text-decoration:none;text-decoration:none;}.css-1hiehca{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;position:relative;box-sizing:border-box;-webkit-tap-highlight-color:transparent;background-color:transparent;outline:0;border:0;margin:0;border-radius:0;padding:0;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;vertical-align:middle;-moz-appearance:none;-webkit-appearance:none;-webkit-text-decoration:none;text-decoration:none;color:inherit;text-align:center;-webkit-flex:0 0 auto;-ms-flex:0 0 auto;flex:0 0 auto;font-size:1.5rem;padding:8px;border-radius:50%;color:rgba(0, 0, 0, 0.54);-webkit-transition:background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;--IconButton-hoverBg:rgba(0, 0, 0, 0.04);margin-right:-12px;color:inherit;padding:12px;font-size:1.75rem;}.css-1hiehca::-moz-focus-inner{border-style:none;}.css-1hiehca.Mui-disabled{pointer-events:none;cursor:default;}@media print{.css-1hiehca{-webkit-print-color-adjust:exact;color-adjust:exact;}}.css-1hiehca:hover{background-color:var(--IconButton-hoverBg);}@media (hover: none){.css-1hiehca:hover{background-color:transparent;}}.css-1hiehca.Mui-disabled{background-color:transparent;color:rgba(0, 0, 0, 0.26);}.css-1hiehca.MuiIconButton-loading{color:transparent;}@media (min-width:0px){.css-1hiehca{display:block;}}@media (min-width:600px){.css-1hiehca{display:none;}}.css-19v1jgj{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:1em;height:1em;display:inline-block;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;-webkit-transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;fill:currentColor;font-size:1.5rem;color:#ff5722;}.css-rcl8vx{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding-left:16px;padding-right:16px;min-height:56px;margin-bottom:24px;}@media (min-width:600px){.css-rcl8vx{padding-left:24px;padding-right:24px;}}@media (min-width:0px){@media (orientation: landscape){.css-rcl8vx{min-height:48px;}}}@media (min-width:600px){.css-rcl8vx{min-height:64px;}}.css-9wvnva{width:100%;margin-left:auto;box-sizing:border-box;margin-right:auto;padding-left:16px;padding-right:16px;}@media (min-width:600px){.css-9wvnva{padding-left:24px;padding-right:24px;}}@media (min-width:1200px){.css-9wvnva{max-width:1200px;}}.css-9yvo9k{--Grid-columns:12;--Grid-columnSpacing:40px;--Grid-rowSpacing:40px;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;min-width:0;box-sizing:border-box;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-flex-wrap:wrap;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;gap:var(--Grid-rowSpacing) var(--Grid-columnSpacing);}.css-9yvo9k >*{--Grid-parent-columns:12;}.css-9yvo9k >*{--Grid-parent-columnSpacing:40px;}.css-9yvo9k >*{--Grid-parent-rowSpacing:40px;}.css-1vyu5pa{-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;-webkit-flex-basis:auto;-ms-flex-preferred-size:auto;flex-basis:auto;width:calc(100% * 12 / var(--Grid-parent-columns) - (var(--Grid-parent-columns) - 12) * (var(--Grid-parent-columnSpacing) / var(--Grid-parent-columns)));min-width:0;box-sizing:border-box;}@media (min-width:900px){.css-1vyu5pa{-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;-webkit-flex-basis:auto;-ms-flex-preferred-size:auto;flex-basis:auto;width:calc(100% * 8 / var(--Grid-parent-columns) - (var(--Grid-parent-columns) - 8) * (var(--Grid-parent-columnSpacing) / var(--Grid-parent-columns)));}}.css-1x6h7g1 .Post-date{margin-right:16px;}.css-1x6h7g1 .Post-category{margin-right:8px;}.css-1x6h7g1 .Post-tagList{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-flex-wrap:wrap;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;padding:4px;}.css-1x6h7g1 .Post-chip{margin:4px;}.css-1x6h7g1 .Post-shareButton{margin-left:8px;padding:8px;border-radius:50%;}.css-yjjqr3{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:1.5625rem;line-height:1.235;letter-spacing:0.00735em;margin-bottom:0.35em;}@media (min-width:600px){.css-yjjqr3{font-size:1.8219rem;}}@media (min-width:900px){.css-yjjqr3{font-size:2.0243rem;}}@media (min-width:1200px){.css-yjjqr3{font-size:2.0243rem;}}.css-68xjr0{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:1rem;line-height:1.5;letter-spacing:0.00938em;color:rgba(0, 0, 0, 0.6);display:inline;}.css-1e0j580{margin:0;font:inherit;line-height:inherit;letter-spacing:inherit;color:#ff5722;-webkit-text-decoration:underline;text-decoration:underline;text-decoration-color:var(--Link-underlineColor);--Link-underlineColor:rgba(255, 87, 34, 0.4);}.css-1e0j580:hover{text-decoration-color:inherit;}.css-16820zy.Content-content{font-size:1.125rem;line-height:1.6;background-color:initial;}.css-16820zy.Content-content a{color:#ff5722;-webkit-text-decoration:none;text-decoration:none;}.css-1yuhvjn{margin-top:16px;}.css-wwkjos{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;position:relative;box-sizing:border-box;-webkit-tap-highlight-color:transparent;background-color:transparent;outline:0;border:0;margin:0;border-radius:0;padding:0;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;vertical-align:middle;-moz-appearance:none;-webkit-appearance:none;-webkit-text-decoration:none;text-decoration:none;color:inherit;max-width:100%;font-family:"Roboto","Helvetica","Arial",sans-serif;font-size:0.8125rem;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;height:32px;line-height:1.5;color:rgba(0, 0, 0, 0.87);background-color:rgba(0, 0, 0, 0.08);border-radius:16px;white-space:nowrap;-webkit-transition:background-color 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;cursor:unset;outline:0;-webkit-text-decoration:none;text-decoration:none;border:0;padding:0;vertical-align:middle;box-sizing:border-box;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;-webkit-tap-highlight-color:transparent;cursor:pointer;background-color:transparent;border:1px solid #bdbdbd;}.css-wwkjos::-moz-focus-inner{border-style:none;}.css-wwkjos.Mui-disabled{pointer-events:none;cursor:default;}@media print{.css-wwkjos{-webkit-print-color-adjust:exact;color-adjust:exact;}}.css-wwkjos.Mui-disabled{opacity:0.38;pointer-events:none;}.css-wwkjos .MuiChip-avatar{margin-left:5px;margin-right:-6px;width:24px;height:24px;color:#616161;font-size:0.75rem;}.css-wwkjos .MuiChip-avatarColorPrimary{color:#fff;background-color:#e64a19;}.css-wwkjos .MuiChip-avatarColorSecondary{color:#fff;background-color:#5d4037;}.css-wwkjos .MuiChip-avatarSmall{margin-left:4px;margin-right:-4px;width:18px;height:18px;font-size:0.625rem;}.css-wwkjos .MuiChip-icon{margin-left:5px;margin-right:-6px;}.css-wwkjos .MuiChip-deleteIcon{-webkit-tap-highlight-color:transparent;color:rgba(0, 0, 0, 0.26);font-size:22px;cursor:pointer;margin:0 5px 0 -6px;}.css-wwkjos .MuiChip-deleteIcon:hover{color:rgba(0, 0, 0, 0.4);}.css-wwkjos .MuiChip-icon{color:#616161;}.css-wwkjos:hover{background-color:rgba(0, 0, 0, 0.12);}.css-wwkjos.Mui-focusVisible{background-color:rgba(0, 0, 0, 0.2);}.css-wwkjos:active{box-shadow:0px 2px 1px -1px rgba(0,0,0,0.2),0px 1px 1px 0px rgba(0,0,0,0.14),0px 1px 3px 0px rgba(0,0,0,0.12);}.css-wwkjos.MuiChip-clickable:hover{background-color:rgba(0, 0, 0, 0.04);}.css-wwkjos.Mui-focusVisible{background-color:rgba(0, 0, 0, 0.12);}.css-wwkjos .MuiChip-avatar{margin-left:4px;}.css-wwkjos .MuiChip-avatarSmall{margin-left:2px;}.css-wwkjos .MuiChip-icon{margin-left:4px;}.css-wwkjos .MuiChip-iconSmall{margin-left:2px;}.css-wwkjos .MuiChip-deleteIcon{margin-right:5px;}.css-wwkjos .MuiChip-deleteIconSmall{margin-right:3px;}.css-qbwvub{overflow:hidden;text-overflow:ellipsis;padding-left:12px;padding-right:12px;white-space:nowrap;padding-left:11px;padding-right:11px;}.css-13dgk6d{margin-top:16px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-1cef0gz{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:500;font-size:1.125rem;line-height:1.6;letter-spacing:0.0075em;display:inline;}@media (min-width:600px){.css-1cef0gz{font-size:1.25rem;}}@media (min-width:900px){.css-1cef0gz{font-size:1.25rem;}}@media (min-width:1200px){.css-1cef0gz{font-size:1.25rem;}}.css-hkx3jt{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;position:relative;box-sizing:border-box;-webkit-tap-highlight-color:transparent;background-color:transparent;outline:0;border:0;margin:0;border-radius:0;padding:0;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;vertical-align:middle;-moz-appearance:none;-webkit-appearance:none;-webkit-text-decoration:none;text-decoration:none;color:inherit;}.css-hkx3jt::-moz-focus-inner{border-style:none;}.css-hkx3jt.Mui-disabled{pointer-events:none;cursor:default;}@media print{.css-hkx3jt{-webkit-print-color-adjust:exact;color-adjust:exact;}}.css-q7mezt{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:1em;height:1em;display:inline-block;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;-webkit-transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;fill:currentColor;font-size:1.5rem;}.css-1ebprri{margin-top:16px;margin-bottom:16px;}.css-hibhi5{--Grid-columns:12;--Grid-columnSpacing:0px;--Grid-rowSpacing:0px;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;min-width:0;box-sizing:border-box;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-flex-wrap:nowrap;-webkit-flex-wrap:nowrap;-ms-flex-wrap:nowrap;flex-wrap:nowrap;gap:var(--Grid-rowSpacing) var(--Grid-columnSpacing);-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;}.css-hibhi5 >*{--Grid-parent-columns:12;}.css-hibhi5 >*{--Grid-parent-columnSpacing:0px;}.css-hibhi5 >*{--Grid-parent-rowSpacing:0px;}.css-hibhi5 .Pagination-nextNav{margin-left:auto;}.css-1n5khr6{min-width:0;box-sizing:border-box;}.css-1ubjslf{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:500;font-size:1.125rem;line-height:1.6;letter-spacing:0.0075em;color:#ff5722;-webkit-text-decoration:underline;text-decoration:underline;text-decoration-color:var(--Link-underlineColor);--Link-underlineColor:rgba(255, 87, 34, 0.4);}@media (min-width:600px){.css-1ubjslf{font-size:1.25rem;}}@media (min-width:900px){.css-1ubjslf{font-size:1.25rem;}}@media (min-width:1200px){.css-1ubjslf{font-size:1.25rem;}}.css-1ubjslf:hover{text-decoration-color:inherit;}.css-20tnkx{-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;-webkit-flex-basis:auto;-ms-flex-preferred-size:auto;flex-basis:auto;width:calc(100% * 12 / var(--Grid-parent-columns) - (var(--Grid-parent-columns) - 12) * (var(--Grid-parent-columnSpacing) / var(--Grid-parent-columns)));min-width:0;box-sizing:border-box;}@media (min-width:900px){.css-20tnkx{-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;-webkit-flex-basis:auto;-ms-flex-preferred-size:auto;flex-basis:auto;width:calc(100% * 4 / var(--Grid-parent-columns) - (var(--Grid-parent-columns) - 4) * (var(--Grid-parent-columnSpacing) / var(--Grid-parent-columns)));}}.css-199nrdm{--Grid-columns:12;--Grid-columnSpacing:32px;--Grid-rowSpacing:32px;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;min-width:0;box-sizing:border-box;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-flex-wrap:wrap;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;gap:var(--Grid-rowSpacing) var(--Grid-columnSpacing);}.css-199nrdm >*{--Grid-parent-columns:12;}.css-199nrdm >*{--Grid-parent-columnSpacing:32px;}.css-199nrdm >*{--Grid-parent-rowSpacing:32px;}.css-fhbwnz{-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;-webkit-flex-basis:auto;-ms-flex-preferred-size:auto;flex-basis:auto;width:calc(100% * 12 / var(--Grid-parent-columns) - (var(--Grid-parent-columns) - 12) * (var(--Grid-parent-columnSpacing) / var(--Grid-parent-columns)));min-width:0;box-sizing:border-box;}@media (min-width:600px){.css-fhbwnz{-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;-webkit-flex-basis:auto;-ms-flex-preferred-size:auto;flex-basis:auto;width:calc(100% * 6 / var(--Grid-parent-columns) - (var(--Grid-parent-columns) - 6) * (var(--Grid-parent-columnSpacing) / var(--Grid-parent-columns)));}}@media (min-width:900px){.css-fhbwnz{-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;-webkit-flex-basis:auto;-ms-flex-preferred-size:auto;flex-basis:auto;width:calc(100% * 12 / var(--Grid-parent-columns) - (var(--Grid-parent-columns) - 12) * (var(--Grid-parent-columnSpacing) / var(--Grid-parent-columns)));}}.css-18b9ajk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:4px 8px;background-color:rgb(229, 229, 229);}.css-penf9g{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:1rem;line-height:1.75;letter-spacing:0.00938em;}.css-xz9haa{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;position:relative;box-sizing:border-box;-webkit-tap-highlight-color:transparent;background-color:transparent;outline:0;border:0;margin:0;border-radius:0;padding:0;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;vertical-align:middle;-moz-appearance:none;-webkit-appearance:none;-webkit-text-decoration:none;text-decoration:none;color:inherit;text-align:center;-webkit-flex:0 0 auto;-ms-flex:0 0 auto;flex:0 0 auto;font-size:1.5rem;padding:8px;border-radius:50%;color:rgba(0, 0, 0, 0.54);-webkit-transition:background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;--IconButton-hoverBg:rgba(0, 0, 0, 0.04);padding:5px;font-size:1.125rem;}.css-xz9haa::-moz-focus-inner{border-style:none;}.css-xz9haa.Mui-disabled{pointer-events:none;cursor:default;}@media print{.css-xz9haa{-webkit-print-color-adjust:exact;color-adjust:exact;}}.css-xz9haa:hover{background-color:var(--IconButton-hoverBg);}@media (hover: none){.css-xz9haa:hover{background-color:transparent;}}.css-xz9haa.Mui-disabled{background-color:transparent;color:rgba(0, 0, 0, 0.26);}.css-xz9haa.MuiIconButton-loading{color:transparent;}.css-15zfxqh{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:1rem;line-height:1.5;letter-spacing:0.00938em;color:#ff5722;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;display:block;-webkit-text-decoration:none;text-decoration:none;}.css-15zfxqh.Categories-link{padding:8px;}.css-15zfxqh.Categories-link:hover{background-color:rgb(229, 229, 229);}.css-15zfxqh.Categories-activeLink{color:rgba(0, 0, 0, 0.54);}.css-tzdv1b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-flex-wrap:wrap;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;padding:8px;}.css-16d0jw{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:1rem;line-height:1.5;letter-spacing:0.00938em;color:#ff5722;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;display:block;-webkit-text-decoration:none;text-decoration:none;}.css-16d0jw.Tags-tagLink{margin:0px 24px 4px 0px;}.css-16d0jw.Tags-activeLink{color:rgba(0, 0, 0, 0.54);}.css-177xvbk{--Grid-columns:12;--Grid-columnSpacing:24px;--Grid-rowSpacing:24px;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;min-width:0;box-sizing:border-box;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-flex-wrap:wrap;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;gap:var(--Grid-rowSpacing) var(--Grid-columnSpacing);}.css-177xvbk >*{--Grid-parent-columns:12;}.css-177xvbk >*{--Grid-parent-columnSpacing:24px;}.css-177xvbk >*{--Grid-parent-rowSpacing:24px;}.css-1rfyg05{min-width:0;box-sizing:border-box;-webkit-box-flex-wrap:wrap;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;gap:8px;}@media (min-width:900px){.css-1rfyg05{-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;-webkit-flex-basis:auto;-ms-flex-preferred-size:auto;flex-basis:auto;width:calc(100% * 4 / var(--Grid-parent-columns) - (var(--Grid-parent-columns) - 4) * (var(--Grid-parent-columnSpacing) / var(--Grid-parent-columns)));}}@media (min-width:0px){.css-1rfyg05{display:none;}}@media (min-width:900px){.css-1rfyg05{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-18q3puk{margin:0;font:inherit;line-height:inherit;letter-spacing:inherit;color:inherit;-webkit-text-decoration:underline;text-decoration:underline;color:inherit;}.css-18q3puk:hover{text-decoration-color:inherit;}.css-1pdhekk{min-width:0;box-sizing:border-box;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}@media (min-width:600px){.css-1pdhekk{-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;-webkit-flex-basis:auto;-ms-flex-preferred-size:auto;flex-basis:auto;width:calc(100% * 6 / var(--Grid-parent-columns) - (var(--Grid-parent-columns) - 6) * (var(--Grid-parent-columnSpacing) / var(--Grid-parent-columns)));}}@media (min-width:900px){.css-1pdhekk{-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;-webkit-flex-basis:auto;-ms-flex-preferred-size:auto;flex-basis:auto;width:calc(100% * 4 / var(--Grid-parent-columns) - (var(--Grid-parent-columns) - 4) * (var(--Grid-parent-columnSpacing) / var(--Grid-parent-columns)));}}.css-deih4v{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;position:relative;box-sizing:border-box;-webkit-tap-highlight-color:transparent;background-color:transparent;outline:0;border:0;margin:0;border-radius:0;padding:0;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;vertical-align:middle;-moz-appearance:none;-webkit-appearance:none;-webkit-text-decoration:none;text-decoration:none;color:inherit;text-align:center;-webkit-flex:0 0 auto;-ms-flex:0 0 auto;flex:0 0 auto;font-size:1.5rem;padding:8px;border-radius:50%;color:rgba(0, 0, 0, 0.54);-webkit-transition:background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;--IconButton-hoverBg:rgba(0, 0, 0, 0.04);padding:12px;font-size:1.75rem;}.css-deih4v::-moz-focus-inner{border-style:none;}.css-deih4v.Mui-disabled{pointer-events:none;cursor:default;}@media print{.css-deih4v{-webkit-print-color-adjust:exact;color-adjust:exact;}}.css-deih4v:hover{background-color:var(--IconButton-hoverBg);}@media (hover: none){.css-deih4v:hover{background-color:transparent;}}.css-deih4v.Mui-disabled{background-color:transparent;color:rgba(0, 0, 0, 0.26);}.css-deih4v.MuiIconButton-loading{color:transparent;}.css-14ecud3{min-width:0;box-sizing:border-box;}@media (min-width:600px){.css-14ecud3{-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;-webkit-flex-basis:auto;-ms-flex-preferred-size:auto;flex-basis:auto;width:calc(100% * 6 / var(--Grid-parent-columns) - (var(--Grid-parent-columns) - 6) * (var(--Grid-parent-columnSpacing) / var(--Grid-parent-columns)));}}@media (min-width:900px){.css-14ecud3{-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;-webkit-flex-basis:auto;-ms-flex-preferred-size:auto;flex-basis:auto;width:calc(100% * 4 / var(--Grid-parent-columns) - (var(--Grid-parent-columns) - 4) * (var(--Grid-parent-columnSpacing) / var(--Grid-parent-columns)));}}.css-2zp2ut{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:0.875rem;line-height:1.43;letter-spacing:0.01071em;color:rgba(0, 0, 0, 0.6);}.css-osloyf{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;position:relative;box-sizing:border-box;-webkit-tap-highlight-color:transparent;background-color:transparent;outline:0;border:0;margin:0;border-radius:0;padding:0;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;vertical-align:middle;-moz-appearance:none;-webkit-appearance:none;-webkit-text-decoration:none;text-decoration:none;color:inherit;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:500;font-size:0.875rem;line-height:1.75;letter-spacing:0.02857em;text-transform:uppercase;min-height:36px;-webkit-transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;border-radius:50%;padding:0;min-width:0;width:56px;height:56px;z-index:1050;box-shadow:0px 3px 5px -1px rgba(0,0,0,0.2),0px 6px 10px 0px rgba(0,0,0,0.14),0px 1px 18px 0px rgba(0,0,0,0.12);color:rgba(0, 0, 0, 0.87);background-color:#e0e0e0;width:48px;height:48px;color:#fff;background-color:#8d6e63;position:fixed;bottom:16px;right:16px;}.css-osloyf::-moz-focus-inner{border-style:none;}.css-osloyf.Mui-disabled{pointer-events:none;cursor:default;}@media print{.css-osloyf{-webkit-print-color-adjust:exact;color-adjust:exact;}}.css-osloyf:active{box-shadow:0px 7px 8px -4px rgba(0,0,0,0.2),0px 12px 17px 2px rgba(0,0,0,0.14),0px 5px 22px 4px rgba(0,0,0,0.12);}.css-osloyf:hover{background-color:#f5f5f5;-webkit-text-decoration:none;text-decoration:none;}@media (hover: none){.css-osloyf:hover{background-color:#e0e0e0;}}.css-osloyf.Mui-focusVisible{box-shadow:0px 3px 5px -1px rgba(0,0,0,0.2),0px 6px 10px 0px rgba(0,0,0,0.14),0px 1px 18px 0px rgba(0,0,0,0.12);}.css-osloyf:hover{background-color:#5d4037;}@media (hover: none){.css-osloyf:hover{background-color:#8d6e63;}}.css-osloyf.Mui-disabled{color:rgba(0, 0, 0, 0.26);box-shadow:none;background-color:rgba(0, 0, 0, 0.12);}</style><style type="text/css">
    .anchor.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .anchor.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){const t=e.target;if(void 0===t.dataset.mainImage)return;if(void 0===t.dataset.gatsbyImageSsr)return;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><script>
      
      
      if(true) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-43244265-2', {"send_page_view":false});
      }
      </script></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><header class="MuiPaper-root MuiPaper-elevation MuiPaper-elevation0 MuiAppBar-root MuiAppBar-colorDefault MuiAppBar-positionFixed mui-fixed css-1c0c9m2" style="--Paper-shadow:none"><div class="MuiToolbar-root MuiToolbar-gutters MuiToolbar-regular css-784rfr"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineAlways css-1972fda" href="/"><div class="MuiAvatar-root MuiAvatar-circular MuiAvatar-colorDefault css-9lpcve"><div data-gatsby-image-wrapper="" style="width:40px;height:40px" class="gatsby-image-wrapper"><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#d8c8c8;width:40px;height:40px;position:relative"></div><picture><source type="image/webp" data-srcset="/static/d08587432fd7f864e0b9d6f9a08966e2/e73fe/photo.webp 40w,/static/d08587432fd7f864e0b9d6f9a08966e2/61ca6/photo.webp 80w" sizes="40px"/><img data-gatsby-image-ssr="" layout="fixed" data-main-image="" style="opacity:0" sizes="40px" decoding="async" loading="lazy" data-src="/static/d08587432fd7f864e0b9d6f9a08966e2/2f28c/photo.jpg" data-srcset="/static/d08587432fd7f864e0b9d6f9a08966e2/2f28c/photo.jpg 40w,/static/d08587432fd7f864e0b9d6f9a08966e2/499f6/photo.jpg 80w" alt="陈柏林"/></picture><noscript><picture><source type="image/webp" srcSet="/static/d08587432fd7f864e0b9d6f9a08966e2/e73fe/photo.webp 40w,/static/d08587432fd7f864e0b9d6f9a08966e2/61ca6/photo.webp 80w" sizes="40px"/><img data-gatsby-image-ssr="" layout="fixed" data-main-image="" style="opacity:0" sizes="40px" decoding="async" loading="lazy" src="/static/d08587432fd7f864e0b9d6f9a08966e2/2f28c/photo.jpg" srcSet="/static/d08587432fd7f864e0b9d6f9a08966e2/2f28c/photo.jpg 40w,/static/d08587432fd7f864e0b9d6f9a08966e2/499f6/photo.jpg 80w" alt="陈柏林"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div></div></a><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineNone css-ughsol" href="/"><h2 class="MuiTypography-root MuiTypography-h5 MuiTypography-alignLeft MuiTypography-noWrap css-2wdn9" style="--Typography-textAlign:left">陈柏林的Blog</h2></a><div class="MuiBox-root css-84nudp"><div class="css-pz8mrn"><a class="MuiTypography-root MuiTypography-body1 MuiTypography-noWrap MuiLink-root MuiLink-underlineNone MenuComponent-toolbarLink css-4rxpbg" aria-haspopup="true" href="/page/">文章</a><a class="MuiTypography-root MuiTypography-body1 MuiTypography-noWrap MuiLink-root MuiLink-underlineNone MenuComponent-toolbarLink css-4rxpbg" target="_blank" rel="noopener" href="https://www.awildpetcat.com/">自由的家猫</a><a class="MuiTypography-root MuiTypography-body1 MuiTypography-noWrap MuiLink-root MuiLink-underlineNone MenuComponent-toolbarLink css-4rxpbg" target="_blank" rel="noopener" href="https://museum.berlinchan.com/">旧站博物馆</a><a class="MuiTypography-root MuiTypography-body1 MuiTypography-noWrap MuiLink-root MuiLink-underlineNone MenuComponent-toolbarLink css-4rxpbg" href="/pages/about/">关于</a></div><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-colorInherit MuiIconButton-edgeEnd MuiIconButton-sizeLarge css-1hiehca" tabindex="0" type="button" aria-label="menu"><svg class="MuiSvgIcon-root MuiSvgIcon-colorPrimary MuiSvgIcon-fontSizeMedium css-19v1jgj" focusable="false" aria-hidden="true" viewBox="0 0 24 24"><path d="M3 18h18v-2H3zm0-5h18v-2H3zm0-7v2h18V6z"></path></svg></button></div></div></header><div class="MuiToolbar-root MuiToolbar-gutters MuiToolbar-regular css-rcl8vx"></div><div class="MuiContainer-root MuiContainer-maxWidthLg css-9wvnva"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-row MuiGrid-spacing-xs-5 css-9yvo9k"><div class="MuiGrid-root MuiGrid-direction-xs-row MuiGrid-grid-xs-12 MuiGrid-grid-md-8 css-1vyu5pa"><div class="css-1x6h7g1"><h2 class="MuiTypography-root MuiTypography-h4 MuiTypography-gutterBottom css-yjjqr3">在 Javascript 中使用公钥加密的介绍</h2><p class="MuiTypography-root MuiTypography-body1 Post-date css-68xjr0">2019-11-08 10:46</p><p class="MuiTypography-root MuiTypography-body1 Post-category css-68xjr0"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineAlways css-1e0j580" href="/category/前端/">前端</a></p><p class="MuiTypography-root MuiTypography-body1 Post-category css-68xjr0"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineAlways css-1e0j580" href="/category/信息安全/">信息安全</a></p><div class="markdown-body Content-content css-16820zy"><!-- endExcerpt -->
<style type="text/css">
    pre {max-height: 30em; overflow: auto;}
</style>
<p>这是一篇翻译。翻译已获得原作者授权。<br>
原文：<a href="https://blog.patricktriest.com/building-an-encrypted-messenger-with-javascript/" target="_blank" rel="nofollow noopener noreferrer">https://blog.patricktriest.com/building-an-encrypted-messenger-with-javascript/</a><br>
作者：<a href="https://blog.patricktriest.com/author/patrick/" target="_blank" rel="nofollow noopener noreferrer">Patrick Triest</a><br>
翻译：陈柏林</p>
<hr>
<h2 id="端到端加密聊天程序---教程" style="position:relative;"><a href="#%E7%AB%AF%E5%88%B0%E7%AB%AF%E5%8A%A0%E5%AF%86%E8%81%8A%E5%A4%A9%E7%A8%8B%E5%BA%8F---%E6%95%99%E7%A8%8B" aria-label="端到端加密聊天程序   教程 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>端到端加密聊天程序 - 教程</h2>
<p>密码学很重要。没有密码学，就没有 Internet —— 在线发送的数据就像在拥挤的房间里大声喊叫一样容易被截获。
密码学也是当前时事中的主要话题，在<a href="https://en.wikipedia.org/wiki/FBI%E2%80%93Apple_encryption_dispute" target="_blank" rel="nofollow noopener noreferrer">执法调查</a>和<a href="https://www.politico.com/tipsheets/morning-cybersecurity/2017/11/10/texas-shooting-could-revive-encryption-legislation-223290" target="_blank" rel="nofollow noopener noreferrer">政府立法</a>中日益发挥中心作用。</p>
<p>对于记者、活动人士、国家、企业和需要保护数据不受黑客、间谍和广告机构威胁的普通人来说，加密是一种无价的工具。</p>
<p>了解如何利用强加密对于现代软件开发至关重要。
在本教程中，我们不会深入研究底层的数学和密码学理论；相反，重点将放在如何在您自己的应用程序利用这些技术。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 760px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/3ddcd4f7188d7a9818daab8d83e1442b/67c4b/screenshot_5.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 55.78947368421052%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA9UlEQVR42o2R226DMAyG8wCD+BDnRIeADphoK+52vetqe//XmaFb14tu5ZMVxXHs35ZN420TuWka7wPeg4jGcRyGoW3blFLO2TkHABoyo4NeaN8tpBgvr7cw82GatPo8z33fay2k75DBgORJS4agN7qrrKVzVe1X6rr+VUY9AWHlr7aVa/Ti/ig/Qr+qLIsQs85AN7YhWWfuupcYa8SMKIh+Ndmo/G7tuXj6sOVnudibtRVAtTH5JP7IMiD3yHq2xJGYYFuydInaUDxjscMiYRkQtGmHhh6he6ZXspOFA8AR4ATYLdslIaPr1b3xv7joWK7OaitfZ/M0Zc6o4mYAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/3ddcd4f7188d7a9818daab8d83e1442b/5ed05/screenshot_5.webp 190w,
/static/3ddcd4f7188d7a9818daab8d83e1442b/9d76b/screenshot_5.webp 380w,
/static/3ddcd4f7188d7a9818daab8d83e1442b/33466/screenshot_5.webp 760w,
/static/3ddcd4f7188d7a9818daab8d83e1442b/ca244/screenshot_5.webp 1140w,
/static/3ddcd4f7188d7a9818daab8d83e1442b/34e40/screenshot_5.webp 1440w"
              sizes="(max-width: 760px) 100vw, 760px"
              type="image/webp"
            />
          <source
            srcset="/static/3ddcd4f7188d7a9818daab8d83e1442b/253c6/screenshot_5.png 190w,
/static/3ddcd4f7188d7a9818daab8d83e1442b/810ee/screenshot_5.png 380w,
/static/3ddcd4f7188d7a9818daab8d83e1442b/b4918/screenshot_5.png 760w,
/static/3ddcd4f7188d7a9818daab8d83e1442b/c0204/screenshot_5.png 1140w,
/static/3ddcd4f7188d7a9818daab8d83e1442b/67c4b/screenshot_5.png 1440w"
            sizes="(max-width: 760px) 100vw, 760px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/3ddcd4f7188d7a9818daab8d83e1442b/b4918/screenshot_5.png"
            alt="Screenshot 5"
            title=""
            loading="lazy"
            decoding="async"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>本教程中，我们将介绍端到端 2048位 <a href="https://en.wikipedia.org/wiki/RSA_(cryptosystem)" target="_blank" rel="nofollow noopener noreferrer">RSA加密</a>消息收发工具的基本概念和实现。
我们将利用 <a href="https://vuejs.org/" target="_blank" rel="nofollow noopener noreferrer">Vue.js</a> 协调前端功能，在 <a href="https://nodejs.org/en/" target="_blank" rel="nofollow noopener noreferrer">Node.js</a> 后端环境中使用 <a href="https://socket.io/" target="_blank" rel="nofollow noopener noreferrer">Socket.io</a>，用于在用户间收发消息。</p>
<ul>
<li>演示 - <a href="https://chat.patricktriest.com" target="_blank" rel="nofollow noopener noreferrer">https://chat.patricktriest.com</a></li>
<li>Github 仓库 - <a href="https://github.com/triestpa/Open-Cryptochat" target="_blank" rel="nofollow noopener noreferrer">https://github.com/triestpa/Open-Cryptochat</a></li>
</ul>
<p>本教程涉及的概念用 Javascript 实现，该语言具有平台无关特性。
我们将构建一个传统的基于浏览器的 Web 应用，但是如果您担心基于浏览器应用程序的安全性，可以修改此代码以使其在预构建的桌面(使用 <a href="https://electronjs.org/" target="_blank" rel="nofollow noopener noreferrer">Electron</a>)或移动应用程序(<a href="https://facebook.github.io/react-native/" target="_blank" rel="nofollow noopener noreferrer">React Native</a>，<a href="https://ionicframework.com/" target="_blank" rel="nofollow noopener noreferrer">Ionic</a>，<a href="https://cordova.apache.org/" target="_blank" rel="nofollow noopener noreferrer">Cordova</a>)二进制文件中工作。<sup><a href="#fn1">[1]</a></sup><a id="fnref1"></a>
用另一种编程语言实现类似的功能应该也简单，因为大多数语言都有著名的开源加密库可用；
虽然语法不同，但核心概念是相同的。</p>
<blockquote>
<p>免责声明 - 本文旨在入门端到端加密的实现，不是构建像诺克斯堡(译注：<a href="https://zh.wikipedia.org/zh-cn/%E8%AF%BA%E5%85%8B%E6%96%AF%E5%A0%A1" target="_blank" rel="nofollow noopener noreferrer">Fort Knox</a>)般固若金汤般浏览器聊天应用程序的权威指南。</p>
<p>我致力于为您的 Javascript 应用程序提供有关加密的有用信息，但不保证应用的 100% 安全。</p>
<p>在构建应用程序过程的各个阶段，有很多可能出现问题的地方，特别是在本教程未涵盖的阶段，例如设置 Web主机和保护服务器安全。</p>
<p>如果您是安全专家，且在教程代码中找到漏洞，请随时通过邮件(patrick.triest#gmail.com)或下面评论部分与我联系。</p>
</blockquote>
<h2 id="1---项目设置" style="position:relative;"><a href="#1---%E9%A1%B9%E7%9B%AE%E8%AE%BE%E7%BD%AE" aria-label="1   项目设置 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>1 - 项目设置</h2>
<h3 id="11---安装依赖" style="position:relative;"><a href="#11---%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96" aria-label="11   安装依赖 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>1.1 - 安装依赖</h3>
<p>你需要安装 <a href="https://nodejs.org/en/" target="_blank" rel="nofollow noopener noreferrer">Node.js</a>(版本 6 或更高) 来运行本应用的后端。</p>
<p>为该项目创建一个空目录，并添加包含如下内容的文件 <code class="language-text">package.json</code>。</p>
<div class="gatsby-highlight" data-language="json"><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"open-cryptochat"</span><span class="token punctuation">,</span>
  <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"1.0.0"</span><span class="token punctuation">,</span>
  <span class="token property">"node"</span><span class="token operator">:</span><span class="token string">"8.1.4"</span><span class="token punctuation">,</span>
  <span class="token property">"license"</span><span class="token operator">:</span> <span class="token string">"MIT"</span><span class="token punctuation">,</span>
  <span class="token property">"author"</span><span class="token operator">:</span> <span class="token string">"patrick.triest#gmail.com"</span><span class="token punctuation">,</span>
  <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"End-to-end RSA-2048 encrypted chat application."</span><span class="token punctuation">,</span>
  <span class="token property">"main"</span><span class="token operator">:</span> <span class="token string">"app.js"</span><span class="token punctuation">,</span>
  <span class="token property">"engines"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"node"</span><span class="token operator">:</span> <span class="token string">">=7.6"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"start"</span><span class="token operator">:</span> <span class="token string">"node app.js"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"express"</span><span class="token operator">:</span> <span class="token string">"4.15.3"</span><span class="token punctuation">,</span>
    <span class="token property">"socket.io"</span><span class="token operator">:</span> <span class="token string">"2.0.3"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>在命令行中运行 <code class="language-text">npm install</code>，安装两个 Node.js 依赖。</p>
<h3 id="12---创建-nodejs-应用" style="position:relative;"><a href="#12---%E5%88%9B%E5%BB%BA-nodejs-%E5%BA%94%E7%94%A8" aria-label="12   创建 nodejs 应用 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>1.2 - 创建 Node.js 应用</h3>
<p>创建文件 <code class="language-text">app.js</code>，添加如下内容。</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>

<span class="token comment">// 设置 Express 服务器</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Server</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span>

<span class="token comment">// 将 Socket.io 附加到服务器</span>
<span class="token keyword">const</span> io <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'socket.io'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>http<span class="token punctuation">)</span>

<span class="token comment">// 伺服 Web 应用目录</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span><span class="token string">'public'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// 这里插入 SOCKET.IO 代码</span>

<span class="token comment">// 启动服务</span>
<span class="token keyword">const</span> port <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">PORT</span> <span class="token operator">||</span> <span class="token number">3000</span>
http<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Chat server listening on port </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div>
<p>这就是服务的核心逻辑。现在，它要做的就是启动服务，并使本地 <code class="language-text">/public</code> 目录中的所有文件可供 Web客户端访问。</p>
<blockquote>
<p>生产环境中，我强烈建议你将前端代码与 Node.js 后端应用分开伺服，使用 <a href="https://httpd.apache.org/" target="_blank" rel="nofollow noopener noreferrer">Apache</a> 和 <a href="https://www.nginx.com/" target="_blank" rel="nofollow noopener noreferrer">Nginx</a> 等久经沙场的服务器软件，或将网站托管在 <a href="https://aws.amazon.com/s3/" target="_blank" rel="nofollow noopener noreferrer">AWS S3</a> 等文件存储服务上。本教程为简单起见，使用 Express 静态文件服务器来伺服前端程序。</p>
</blockquote>
<h3 id="13---添加前端" style="position:relative;"><a href="#13---%E6%B7%BB%E5%8A%A0%E5%89%8D%E7%AB%AF" aria-label="13   添加前端 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>1.3 - 添加前端</h3>
<p>创建新目录 <code class="language-text">public</code>。这里放所有前端应用代码。</p>
<h5 id="131---添加-html-模板" style="position:relative;"><a href="#131---%E6%B7%BB%E5%8A%A0-html-%E6%A8%A1%E6%9D%BF" aria-label="131   添加 html 模板 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>1.3.1 - 添加 HTML 模板</h5>
<p>新建文件 <code class="language-text">/public/index.html</code>，添加如下内容。</p>
<div class="gatsby-highlight" data-language="html"><pre class="language-html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Open Cryptochat<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>description<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>A minimalist, open-source, end-to-end RSA-2048 encrypted chat application.<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://fonts.googleapis.com/css?family=Montserrat:300,400<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://fonts.googleapis.com/css?family=Roboto+Mono<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/styles.css<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>vue-instance<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
      <span class="token comment">&lt;!-- Add Chat Container Here --></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>info-container full-width<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token comment">&lt;!-- Add Room UI Here --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>notification-list<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>notificationContainer<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>NOTIFICATION LOG<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>notification full-width<span class="token punctuation">"</span></span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>notification in notifications<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>notification-timestamp<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>{{ notification.timestamp }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>notification-message<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>{{ notification.message }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>flex-fill<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
        <span class="token comment">&lt;!-- Add Encryption Key UI Here --></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
      <span class="token comment">&lt;!-- Add Bottom Bar Here --></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://cdnjs.cloudflare.com/ajax/libs/vue/2.4.1/vue.min.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.3/socket.io.slim.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://cdnjs.cloudflare.com/ajax/libs/immutable/3.8.1/immutable.min.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/page.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre></div>
<p>该模板设置基础 HTML 结构并下载客户端 JS 依赖项。等添加客户端 JS 代码后，它还会显示一个简单的通知列表。</p>
<h5 id="132---创建-vuejs-应用程序" style="position:relative;"><a href="#132---%E5%88%9B%E5%BB%BA-vuejs-%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F" aria-label="132   创建 vuejs 应用程序 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>1.3.2 - 创建 Vue.js 应用程序</h5>
<p>新建 <code class="language-text">/public/page.js</code> 并添加如下内容。</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">/** 控制 UI 的 Vue 实例 */</span>
<span class="token keyword">const</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">el</span><span class="token operator">:</span> <span class="token string">'#vue-instance'</span><span class="token punctuation">,</span>
  <span class="token function">data</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">cryptWorker</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
      <span class="token literal-property property">socket</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
      <span class="token literal-property property">originPublicKey</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
      <span class="token literal-property property">destinationPublicKey</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
      <span class="token literal-property property">messages</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token literal-property property">notifications</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token literal-property property">currentRoom</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
      <span class="token literal-property property">pendingRoom</span><span class="token operator">:</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">draft</span><span class="token operator">:</span> <span class="token string">''</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">created</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addNotification</span><span class="token punctuation">(</span><span class="token string">'Hello World'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">/** 在 UI 中追加一条通知消息 */</span>
    <span class="token function">addNotification</span> <span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> timestamp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLocaleTimeString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>notifications<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token punctuation">,</span> timestamp <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div>
<p>该脚本将初始化 Vue.js 应用，并在 UI 中显示一个 “Hello World” 通知。</p>
<h5 id="133---添加样式" style="position:relative;"><a href="#133---%E6%B7%BB%E5%8A%A0%E6%A0%B7%E5%BC%8F" aria-label="133   添加样式 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>1.3.3 - 添加样式</h5>
<p>新建文件 <code class="language-text">/public/styles.css</code>，粘贴进如下样式。</p>
<div class="gatsby-highlight" data-language="scss"><pre class="language-scss"><code class="language-scss"><span class="token comment">/* Global */</span>
<span class="token selector">:root </span><span class="token punctuation">{</span>
  <span class="token property">--black</span><span class="token punctuation">:</span> #111111<span class="token punctuation">;</span>
  <span class="token property">--light-grey</span><span class="token punctuation">:</span> #d6d6d6<span class="token punctuation">;</span>
  <span class="token property">--highlight</span><span class="token punctuation">:</span> yellow<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">body </span><span class="token punctuation">{</span>
  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--black<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token property">color</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--light-grey<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token property">font-family</span><span class="token punctuation">:</span> <span class="token string">'Roboto Mono'</span><span class="token punctuation">,</span> monospace<span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 100vh<span class="token punctuation">;</span>
  <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
  <span class="token property">padding</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
  <span class="token property">margin</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">div </span><span class="token punctuation">{</span> <span class="token property">box-sizing</span><span class="token punctuation">:</span> border-box<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">input, textarea, select </span><span class="token punctuation">{</span> <span class="token property">font-family</span><span class="token punctuation">:</span> inherit<span class="token punctuation">;</span> <span class="token property">font-size</span><span class="token punctuation">:</span> small<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">textarea:focus, input:focus </span><span class="token punctuation">{</span> <span class="token property">outline</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token selector">.full-width </span><span class="token punctuation">{</span> <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">.green </span><span class="token punctuation">{</span> <span class="token property">color</span><span class="token punctuation">:</span> green<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">.red </span><span class="token punctuation">{</span> <span class="token property">color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">.yellow </span><span class="token punctuation">{</span> <span class="token property">color</span><span class="token punctuation">:</span> yellow<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">.center-x </span><span class="token punctuation">{</span> <span class="token property">margin</span><span class="token punctuation">:</span> 0 auto<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">.center-text </span><span class="token punctuation">{</span> <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span> <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token selector">h1, h2, h3 </span><span class="token punctuation">{</span> <span class="token property">font-family</span><span class="token punctuation">:</span> <span class="token string">'Montserrat'</span><span class="token punctuation">,</span> sans-serif<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">h1 </span><span class="token punctuation">{</span> <span class="token property">font-size</span><span class="token punctuation">:</span> medium<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">h2 </span><span class="token punctuation">{</span> <span class="token property">font-size</span><span class="token punctuation">:</span> small<span class="token punctuation">;</span> <span class="token property">font-weight</span><span class="token punctuation">:</span> 300<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">h3 </span><span class="token punctuation">{</span> <span class="token property">font-size</span><span class="token punctuation">:</span> x-small<span class="token punctuation">;</span> <span class="token property">font-weight</span><span class="token punctuation">:</span> 300<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">p </span><span class="token punctuation">{</span> <span class="token property">font-size</span><span class="token punctuation">:</span> x-small<span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token selector">.clearfix:after </span><span class="token punctuation">{</span>
   <span class="token property">visibility</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>
   <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span>
   <span class="token property">height</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
   <span class="token property">clear</span><span class="token punctuation">:</span> both<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">#vue-instance </span><span class="token punctuation">{</span>
  <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
  <span class="token property">flex-direction</span><span class="token punctuation">:</span> row<span class="token punctuation">;</span>
  <span class="token property">flex</span><span class="token punctuation">:</span> 1 0 100%<span class="token punctuation">;</span>
  <span class="token property">overflow-x</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/** Chat Window **/</span>
<span class="token selector">.chat-container </span><span class="token punctuation">{</span>
  <span class="token property">flex</span><span class="token punctuation">:</span> 0 0 60%<span class="token punctuation">;</span>
  <span class="token property">word-wrap</span><span class="token punctuation">:</span> break-word<span class="token punctuation">;</span>
  <span class="token property">overflow-x</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>
  <span class="token property">overflow-y</span><span class="token punctuation">:</span> scroll<span class="token punctuation">;</span>
  <span class="token property">padding</span><span class="token punctuation">:</span> 6px<span class="token punctuation">;</span>
  <span class="token property">margin-bottom</span><span class="token punctuation">:</span> 50px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.message > p </span><span class="token punctuation">{</span> <span class="token property">font-size</span><span class="token punctuation">:</span> small<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">.title-header > p </span><span class="token punctuation">{</span>
  <span class="token property">font-family</span><span class="token punctuation">:</span> <span class="token string">'Montserrat'</span><span class="token punctuation">,</span> sans-serif<span class="token punctuation">;</span>
  <span class="token property">font-weight</span><span class="token punctuation">:</span> 300<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/* Info Panel */</span>
<span class="token selector">.info-container </span><span class="token punctuation">{</span>
  <span class="token property">flex</span><span class="token punctuation">:</span> 0 0 40%<span class="token punctuation">;</span>
  <span class="token property">border-left</span><span class="token punctuation">:</span> solid 1px <span class="token function">var</span><span class="token punctuation">(</span>--light-grey<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token property">padding</span><span class="token punctuation">:</span> 12px<span class="token punctuation">;</span>
  <span class="token property">overflow-x</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>
  <span class="token property">overflow-y</span><span class="token punctuation">:</span> scroll<span class="token punctuation">;</span>
  <span class="token property">margin-bottom</span><span class="token punctuation">:</span> 50px<span class="token punctuation">;</span>
  <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span>
  <span class="token property">justify-content</span><span class="token punctuation">:</span> space-around<span class="token punctuation">;</span>
  <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
  <span class="token property">flex-direction</span><span class="token punctuation">:</span> column<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.divider </span><span class="token punctuation">{</span>
  <span class="token property">padding-top</span><span class="token punctuation">:</span> 1px<span class="token punctuation">;</span>
  <span class="token property">max-height</span><span class="token punctuation">:</span> 0px<span class="token punctuation">;</span>
  <span class="token property">min-width</span><span class="token punctuation">:</span> 200%<span class="token punctuation">;</span>
  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--light-grey<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token property">margin</span><span class="token punctuation">:</span> 12px -12px<span class="token punctuation">;</span>
  <span class="token property">flex</span><span class="token punctuation">:</span> 1 0<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.notification-list </span><span class="token punctuation">{</span>
  <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
  <span class="token property">flex-direction</span><span class="token punctuation">:</span> column<span class="token punctuation">;</span>
  <span class="token property">overflow</span><span class="token punctuation">:</span> scroll<span class="token punctuation">;</span>
  <span class="token property">padding-bottom</span><span class="token punctuation">:</span> 24px<span class="token punctuation">;</span>
  <span class="token property">flex</span><span class="token punctuation">:</span> 1 0 40%<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.notification </span><span class="token punctuation">{</span>
  <span class="token property">font-family</span><span class="token punctuation">:</span> <span class="token string">'Montserrat'</span><span class="token punctuation">,</span> sans-serif<span class="token punctuation">;</span>
  <span class="token property">font-weight</span><span class="token punctuation">:</span> 300<span class="token punctuation">;</span>
  <span class="token property">font-size</span><span class="token punctuation">:</span> small<span class="token punctuation">;</span>
  <span class="token property">padding</span><span class="token punctuation">:</span> 4px 0<span class="token punctuation">;</span>
  <span class="token property">display</span><span class="token punctuation">:</span> inline-flex<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.notification-timestamp </span><span class="token punctuation">{</span>
  <span class="token property">flex</span><span class="token punctuation">:</span> 0 0 20%<span class="token punctuation">;</span>
  <span class="token property">padding-right</span><span class="token punctuation">:</span> 12px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.notification-message </span><span class="token punctuation">{</span> <span class="token property">flex</span><span class="token punctuation">:</span> 0 0 80%<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">.notification:last-child </span><span class="token punctuation">{</span>
  <span class="token property">margin-bottom</span><span class="token punctuation">:</span> 24px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.keys </span><span class="token punctuation">{</span>
  <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span>
  <span class="token property">font-size</span><span class="token punctuation">:</span> xx-small<span class="token punctuation">;</span>
  <span class="token property">overflow-x</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>
  <span class="token property">overflow-y</span><span class="token punctuation">:</span> scroll<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.keys > .divider </span><span class="token punctuation">{</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 75%<span class="token punctuation">;</span>
  <span class="token property">min-width</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
  <span class="token property">margin</span><span class="token punctuation">:</span> 16px auto<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.key </span><span class="token punctuation">{</span> <span class="token property">overflow</span><span class="token punctuation">:</span> scroll<span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token selector">.room-select </span><span class="token punctuation">{</span>
  <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
  <span class="token property">min-height</span><span class="token punctuation">:</span> 24px<span class="token punctuation">;</span>
  <span class="token property">font-family</span><span class="token punctuation">:</span> <span class="token string">'Montserrat'</span><span class="token punctuation">,</span> sans-serif<span class="token punctuation">;</span>
  <span class="token property">font-weight</span><span class="token punctuation">:</span> 300<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">#room-input </span><span class="token punctuation">{</span>
    <span class="token property">flex</span><span class="token punctuation">:</span> 0 0 60%<span class="token punctuation">;</span>
    <span class="token property">background</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
    <span class="token property">border</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
    <span class="token property">border-bottom</span><span class="token punctuation">:</span> 1px solid <span class="token function">var</span><span class="token punctuation">(</span>--light-grey<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token property">border-top</span><span class="token punctuation">:</span> 1px solid <span class="token function">var</span><span class="token punctuation">(</span>--light-grey<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token property">border-left</span><span class="token punctuation">:</span> 1px solid <span class="token function">var</span><span class="token punctuation">(</span>--light-grey<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token property">color</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--light-grey<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token property">padding</span><span class="token punctuation">:</span> 4px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.yellow-button </span><span class="token punctuation">{</span>
  <span class="token property">flex</span><span class="token punctuation">:</span> 0 0 30%<span class="token punctuation">;</span>
  <span class="token property">background</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
  <span class="token property">border</span><span class="token punctuation">:</span> 1px solid <span class="token function">var</span><span class="token punctuation">(</span>--highlight<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token property">color</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--highlight<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token property">cursor</span><span class="token punctuation">:</span> pointer<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.yellow-button:hover </span><span class="token punctuation">{</span>
  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--highlight<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token property">color</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--black<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.yellow > a </span><span class="token punctuation">{</span> <span class="token property">color</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--highlight<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token selector">.loader </span><span class="token punctuation">{</span>
    <span class="token property">border</span><span class="token punctuation">:</span> 4px solid black<span class="token punctuation">;</span>
    <span class="token property">border-top</span><span class="token punctuation">:</span> 4px solid <span class="token function">var</span><span class="token punctuation">(</span>--highlight<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token property">border-radius</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 48px<span class="token punctuation">;</span>
    <span class="token property">height</span><span class="token punctuation">:</span> 48px<span class="token punctuation">;</span>
    <span class="token property">animation</span><span class="token punctuation">:</span> spin 2s linear infinite<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token atrule"><span class="token rule">@keyframes</span> spin</span> <span class="token punctuation">{</span>
    <span class="token selector">0% </span><span class="token punctuation">{</span> <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>0deg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token selector">100% </span><span class="token punctuation">{</span> <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>360deg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/* Message Input Bar */</span>
<span class="token selector">.message-input </span><span class="token punctuation">{</span>
  <span class="token property">background</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
  <span class="token property">border</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
  <span class="token property">color</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--light-grey<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 90%<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.bottom-bar </span><span class="token punctuation">{</span>
  <span class="token property">border-top</span><span class="token punctuation">:</span> solid 1px <span class="token function">var</span><span class="token punctuation">(</span>--light-grey<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--black<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token property">position</span><span class="token punctuation">:</span> fixed<span class="token punctuation">;</span>
  <span class="token property">bottom</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
  <span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
  <span class="token property">padding</span><span class="token punctuation">:</span> 12px<span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 48px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.message-list </span><span class="token punctuation">{</span>
  <span class="token property">margin-bottom</span><span class="token punctuation">:</span> 40px<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>这里不深入讨论 CSS，但我向您保证它相当简单。</p>
<p>简单起见，我们不需要在前端中添加构建系统。在我看来，对于一个如此简单的应用程序来说，构建系统并不是必须的(完成应用程序的 gzip 压缩总负载小于 100kb)。
非常欢迎(并鼓励，因为它将允许应用程序向后兼容过时的浏览器)你添加一个构建系统，如 <a href="https://webpack.js.org/" target="_blank" rel="nofollow noopener noreferrer">Webpack</a>、 <a href="https://gulpjs.com/" target="_blank" rel="nofollow noopener noreferrer">Gulp</a> 或 <a href="https://rollupjs.org/" target="_blank" rel="nofollow noopener noreferrer">Rollup</a>，如果您决定将此代码应用到您自己的项目中。</p>
<h3 id="14---试试看" style="position:relative;"><a href="#14---%E8%AF%95%E8%AF%95%E7%9C%8B" aria-label="14   试试看 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>1.4 - 试试看</h3>
<p>在命令行中运行 <code class="language-text">npm start</code>。应该能看到命令行输出 <code class="language-text">Chat server listening on port 3000.</code>。
在浏览器中访问 <a href="http://localhost:3000" target="_blank" rel="nofollow noopener noreferrer"><code class="language-text">http://localhost:3000</code></a>，应该能看到一个空的黑色界面，在页面上显示 “Hello World”。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 760px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/e10103d34f0e1784c46f63d84108f13c/67c4b/screenshot_1.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 55.78947368421052%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAMklEQVR42mNQV1dXVVWVlZUVEBAQJBEwiIiIALUJCQkJkg5AmgXJBaOah45m8pIHRDMAiFAsyIvMBpUAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/e10103d34f0e1784c46f63d84108f13c/5ed05/screenshot_1.webp 190w,
/static/e10103d34f0e1784c46f63d84108f13c/9d76b/screenshot_1.webp 380w,
/static/e10103d34f0e1784c46f63d84108f13c/33466/screenshot_1.webp 760w,
/static/e10103d34f0e1784c46f63d84108f13c/ca244/screenshot_1.webp 1140w,
/static/e10103d34f0e1784c46f63d84108f13c/34e40/screenshot_1.webp 1440w"
              sizes="(max-width: 760px) 100vw, 760px"
              type="image/webp"
            />
          <source
            srcset="/static/e10103d34f0e1784c46f63d84108f13c/253c6/screenshot_1.png 190w,
/static/e10103d34f0e1784c46f63d84108f13c/810ee/screenshot_1.png 380w,
/static/e10103d34f0e1784c46f63d84108f13c/b4918/screenshot_1.png 760w,
/static/e10103d34f0e1784c46f63d84108f13c/c0204/screenshot_1.png 1140w,
/static/e10103d34f0e1784c46f63d84108f13c/67c4b/screenshot_1.png 1440w"
            sizes="(max-width: 760px) 100vw, 760px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/e10103d34f0e1784c46f63d84108f13c/b4918/screenshot_1.png"
            alt="Screenshot 1"
            title=""
            loading="lazy"
            decoding="async"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<h2 id="2---基础消息收发" style="position:relative;"><a href="#2---%E5%9F%BA%E7%A1%80%E6%B6%88%E6%81%AF%E6%94%B6%E5%8F%91" aria-label="2   基础消息收发 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>2 - 基础消息收发</h2>
<p>现在项目脚手架已就绪，我们将开始添加基础的(非加密)实时消息收发功能。</p>
<h3 id="21---设置服务器端-socket-监听器" style="position:relative;"><a href="#21---%E8%AE%BE%E7%BD%AE%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF-socket-%E7%9B%91%E5%90%AC%E5%99%A8" aria-label="21   设置服务器端 socket 监听器 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>2.1 - 设置服务器端 Socket 监听器</h3>
<p>在文件 <code class="language-text">/app.js</code> 的注释 <code class="language-text">// 这里插入 SOCKET.IO 代码</code> 处，添加如下代码。</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">/** 管理每个客户端 socket 连接的行为 */</span>
io<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'connection'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">socket</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">User Connected - Socket ID </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>socket<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>

  <span class="token comment">// 储存 socket 连接到的聊天室</span>
  <span class="token keyword">let</span> currentRoom <span class="token operator">=</span> <span class="token string">'DEFAULT'</span>

  <span class="token comment">/** 处理加入聊天室的请求. */</span>
  socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'JOIN'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">roomName</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    socket<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>currentRoom<span class="token punctuation">)</span>

    <span class="token comment">// 通知用户，加入聊天室成功</span>
    io<span class="token punctuation">.</span><span class="token function">to</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'ROOM_JOINED'</span><span class="token punctuation">,</span> currentRoom<span class="token punctuation">)</span>

    <span class="token comment">// 通知聊天室，用户加入成功</span>
    socket<span class="token punctuation">.</span>broadcast<span class="token punctuation">.</span><span class="token function">to</span><span class="token punctuation">(</span>currentRoom<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'NEW_CONNECTION'</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">/** 在聊天室广播一条收到的消息 */</span>
  socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'MESSAGE'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">New Message - </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>msg<span class="token punctuation">.</span>text<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    socket<span class="token punctuation">.</span>broadcast<span class="token punctuation">.</span><span class="token function">to</span><span class="token punctuation">(</span>currentRoom<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'MESSAGE'</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div>
<p>此代码块将创建一个连接监听器，管理从前端应用程序连接到服务器的所有客户端。
目前，它只将用户添加到 <code class="language-text">DEFAULT</code> 聊天室中，然后将接收到的所有消息重新发送给聊天室中的其他用户。</p>
<h3 id="22---设置客户端-socket-监听器" style="position:relative;"><a href="#22---%E8%AE%BE%E7%BD%AE%E5%AE%A2%E6%88%B7%E7%AB%AF-socket-%E7%9B%91%E5%90%AC%E5%99%A8" aria-label="22   设置客户端 socket 监听器 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>2.2 - 设置客户端 Socket 监听器</h3>
<p>在前端中，我们将添加一些连接到服务器的代码，用如下代码替换文件 <code class="language-text">/public/page.js</code> 中的 <code class="language-text">created</code> 函数。</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token function">created</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 初始化 socket.io</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>socket <span class="token operator">=</span> <span class="token function">io</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setupSocketListeners</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre></div>
<p>接着，我们要添加一些自定义函数来管理客户端 Socket 连接并收发消息。
在文件 <code class="language-text">/public/page.js</code> 中 Vue 应用的 <code class="language-text">methods</code> 代码块中添加如下。</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">/** 设置 Socket.io 事件监听器 */</span>
<span class="token function">setupSocketListeners</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 连接时自动加入默认聊天室</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'connect'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addNotification</span><span class="token punctuation">(</span><span class="token string">'Connected To Server.'</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">joinRoom</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">// 通知用户丢失 socket 连接</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'disconnect'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addNotification</span><span class="token punctuation">(</span><span class="token string">'Lost Connection'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token comment">// 接收消息并显示</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'MESSAGE'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>

<span class="token comment">/** 发送消息 */</span>
<span class="token function">sendMessage</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 消息为空时不发送</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>draft <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>draft <span class="token operator">===</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span>

  <span class="token keyword">const</span> message <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>draft

  <span class="token comment">// 重置输入文本</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>draft <span class="token operator">=</span> <span class="token string">''</span>

  <span class="token comment">// 将消息立即显示到本地 UI</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span>

  <span class="token comment">// 发送消息</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>socket<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'MESSAGE'</span><span class="token punctuation">,</span> message<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>

<span class="token comment">/** 加入聊天室 */</span>
<span class="token function">joinRoom</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>socket<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'JOIN'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>

<span class="token comment">/** 将消息添加到 UI */</span>
<span class="token function">addMessage</span> <span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>messages<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre></div>
<h3 id="23---将消息显示到-ui" style="position:relative;"><a href="#23---%E5%B0%86%E6%B6%88%E6%81%AF%E6%98%BE%E7%A4%BA%E5%88%B0-ui" aria-label="23   将消息显示到 ui permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>2.3 - 将消息显示到 UI</h3>
<p>最后，我们为发送与显示消息提供一个 UI。</p>
<p>为在当前聊天中显示所有消息，在文件 <code class="language-text">/public/index.html</code> 的 <code class="language-text">&lt;!-- Add Chat Container Here --></code> 注释处添加如下。</p>
<div class="gatsby-highlight" data-language="html"><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>chat-container full-width<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>chatContainer<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>message-list<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>message full-width<span class="token punctuation">"</span></span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>message in messages<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>
      > {{ message }}
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre></div>
<p>添加一个文本输入框让用户输入消息，在 <code class="language-text">/public/index.html</code> 的 <code class="language-text">&lt;!-- Add Bottom Bar Here --></code> 注释处添加如下。</p>
<div class="gatsby-highlight" data-language="html"><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bottom-bar full-width<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  > <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>message-input<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Message<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>draft<span class="token punctuation">"</span></span> <span class="token attr-name">@keyup.enter</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sendMessage()<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre></div>
<p>现在重启服务，在浏览器的两个不同标签页或窗口中打开 <a href="http://localhost:3000" target="_blank" rel="nofollow noopener noreferrer"><code class="language-text">http://localhost:3000</code></a>。
尝试在标签页之间来回发送消息。在命令行中，您应该能够看到正在发送的消息的服务器日志。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 760px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/812ad39380a23adc53cbae0d1762f4b8/67c4b/screenshot_2.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 55.78947368421052%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAZElEQVR42u2SOw7AIAxDcwNCAkJFDAyQ+x8Rd6k68Fk69k1R7LeZWmu995SSXyAiZoZOrTXGyMxPRNBKKVfOGzmEAEdVcb8jwtcBdhsZ2jQif+KXP5TlBExsYxrdI8EGdMuqMADN1i5ybuV6rAAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/812ad39380a23adc53cbae0d1762f4b8/5ed05/screenshot_2.webp 190w,
/static/812ad39380a23adc53cbae0d1762f4b8/9d76b/screenshot_2.webp 380w,
/static/812ad39380a23adc53cbae0d1762f4b8/33466/screenshot_2.webp 760w,
/static/812ad39380a23adc53cbae0d1762f4b8/ca244/screenshot_2.webp 1140w,
/static/812ad39380a23adc53cbae0d1762f4b8/34e40/screenshot_2.webp 1440w"
              sizes="(max-width: 760px) 100vw, 760px"
              type="image/webp"
            />
          <source
            srcset="/static/812ad39380a23adc53cbae0d1762f4b8/253c6/screenshot_2.png 190w,
/static/812ad39380a23adc53cbae0d1762f4b8/810ee/screenshot_2.png 380w,
/static/812ad39380a23adc53cbae0d1762f4b8/b4918/screenshot_2.png 760w,
/static/812ad39380a23adc53cbae0d1762f4b8/c0204/screenshot_2.png 1140w,
/static/812ad39380a23adc53cbae0d1762f4b8/67c4b/screenshot_2.png 1440w"
            sizes="(max-width: 760px) 100vw, 760px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/812ad39380a23adc53cbae0d1762f4b8/b4918/screenshot_2.png"
            alt="Screenshot 2"
            title=""
            loading="lazy"
            decoding="async"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span><br>
<span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 760px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/d2ac120214b07292db389b0fe54991e8/2658a/screenshot_3.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 16.842105263157894%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAIAAAAcOLh5AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAX0lEQVR42mOQkpJWUlaWEJcQEREVFBSSkZERFBTk5uZmY2NjIAgMDAwtLK20tXWMjU0MDA11dPU0NLXU1NWFhISAsoyMjPg06wJVa2hISUlpammpqKoqKiry8fExEAcA+HUJiQxGLCEAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/d2ac120214b07292db389b0fe54991e8/5ed05/screenshot_3.webp 190w,
/static/d2ac120214b07292db389b0fe54991e8/9d76b/screenshot_3.webp 380w,
/static/d2ac120214b07292db389b0fe54991e8/33466/screenshot_3.webp 760w,
/static/d2ac120214b07292db389b0fe54991e8/79961/screenshot_3.webp 792w"
              sizes="(max-width: 760px) 100vw, 760px"
              type="image/webp"
            />
          <source
            srcset="/static/d2ac120214b07292db389b0fe54991e8/253c6/screenshot_3.png 190w,
/static/d2ac120214b07292db389b0fe54991e8/810ee/screenshot_3.png 380w,
/static/d2ac120214b07292db389b0fe54991e8/b4918/screenshot_3.png 760w,
/static/d2ac120214b07292db389b0fe54991e8/2658a/screenshot_3.png 792w"
            sizes="(max-width: 760px) 100vw, 760px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/d2ac120214b07292db389b0fe54991e8/b4918/screenshot_3.png"
            alt="Screenshot 3"
            title=""
            loading="lazy"
            decoding="async"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<h3 id="数据加密-101" style="position:relative;"><a href="#%E6%95%B0%E6%8D%AE%E5%8A%A0%E5%AF%86-101" aria-label="数据加密 101 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>数据加密 101</h3>
<p>Cool, 现在我们有了一个实时消息收发应用。在添加端到端加密之前，必须对非对称加密的工作原理有基本的了解。</p>
<h4 id="对称加密-与-单向函数" style="position:relative;"><a href="#%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86-%E4%B8%8E-%E5%8D%95%E5%90%91%E5%87%BD%E6%95%B0" aria-label="对称加密 与 单向函数 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>对称加密 与 单向函数</h4>
<p>假设我们在交换一个秘密数字。我们通过第三方发送这个数字，但不想让第三方知道数字是什么。</p>
<p>为实现这一点，我们先共享一个密钥 —— 就用 <code class="language-text">7</code>。</p>
<p>为了加密消息，先用一个随机数字 <code class="language-text">n</code> 与密钥(<code class="language-text">7</code>)相乘，再与 <code class="language-text">x</code> 相加。
该等式中，<code class="language-text">x</code> 表示我们要发送的数字，<code class="language-text">y</code> 表示加密后的结果。</p>
<p><code class="language-text">(7 * n) + x = y</code></p>
<p>然后，我们可以使用模运算将加密的输入转换为解密的输出。</p>
<p><code class="language-text">y mod 7 = x</code></p>
<p>这里，<code class="language-text">y</code> 是公开的(加密的)消息，<code class="language-text">x</code> 是原始的未加密消息。</p>
<p>如果一方想交换数字 <code class="language-text">2</code>，我们可以计算 <code class="language-text">(7*4) + 2</code> 并发送 <code class="language-text">30</code> 作为消息。
我们都知道密钥 (<code class="language-text">7</code>)，所以都能计算 <code class="language-text">30 mod 7</code>，并确定 <code class="language-text">2</code> 是原始的数字。</p>
<p>原始数字(<code class="language-text">2</code>)实际上是隐藏起来的，因为我们传递的唯一消息是 <code class="language-text">30</code>。
就算第三方能同时得到加密的结果(<code class="language-text">30</code>)和加密的未数字(<code class="language-text">2</code>)，他仍然不知道密钥的值。
本例中，<code class="language-text">30 mod 14</code> 与 <code class="language-text">30 mod 28</code> 都等于 <code class="language-text">2</code>，所以中间人并不能确定密钥是 <code class="language-text">7</code>，<code class="language-text">14</code>还是 <code class="language-text">28</code>，因此无法可靠地破译下一条消息。</p>
<p>因此，取模(Modulo)运算被认为是一个“单向”函数，因为它不能被简单地逆运算。</p>
<p>现代加密算法就是对该通用原理的复杂化应用。
通过使用大质数(large prime numbers)，模幂(modular exponentiation)，长私钥和多轮密码转换，破解这些算法通常要花费非常长的时间(1+百万年)。</p>
<blockquote>
<p>理论上，量子计算机可以很快破解。详情见 <a href="https://www.infoworld.com/article/3040991/security/mits-new-5-atom-quantum-computer-could-make-todays-encryption-obsolete.html" target="_blank" rel="nofollow noopener noreferrer">这里</a>。
这项技术还处于起步阶段，所以我们可能还无需担心加密数据会以这种方式泄露。</p>
</blockquote>
<p>上面的示例假设双方都可以提前交换密钥(本例中为7)。这被称为 <em>对称加密</em>，因为加密和解密消息都使用相同的密钥。
然而，在 Internet 上，这通常不是可行 —— 我们需要一种不必离线协调获取共享密钥，而加密消息的方法。
这就是非对称加密发挥作用的地方。</p>
<h4 id="公钥加密" style="position:relative;"><a href="#%E5%85%AC%E9%92%A5%E5%8A%A0%E5%AF%86" aria-label="公钥加密 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>公钥加密</h4>
<p>与对称加密使用一个共享密钥不同，公钥加密(非对称加密)使用一对密钥(公钥、私钥)，<em>公钥</em> 用于加密数据，<em>私钥</em> 用于解密。</p>
<p><em>公钥</em> 就像一个有牢不可破锁的公开投信箱。如果有人想给你发消息，就将消息投入这个公开信箱，然后盖上盖子把它锁上。
这时信箱就能让不被信任的第三方传递发送，而不必担心内容被曝光。
一旦我收到信箱，我会用我的 <em>私钥</em> ——只有我有，来打开信箱。</p>
<p>交换 <em>公钥</em> 就像交换这些公开信箱，但 <em>私钥</em> 仅由信箱所有者保管，所以在信箱传递过程中能保证内容的安全。</p>
<p>当然，这是对公钥加密原理的一个简化解释。如果你好奇(特别是关于这些技术的历史和数学基础)，我强烈推荐你从这两个视频开始。</p>
<p><div class="gatsby-resp-iframe-wrapper" style="padding-bottom: 56.49999999999999%; position: relative; height: 0; overflow: hidden; margin-bottom: 1.0725rem" > <div class="embedVideo-container"> <iframe title="" src="https://www.youtube.com/embed/YEBfamv-_do?rel=0" class="embedVideo-iframe" style="border:0; position: absolute; top: 0; left: 0; width: 100%; height: 100%; " loading="eager" allowfullscreen="" sandbox="allow-same-origin allow-scripts allow-popups"></iframe> </div> </div></p>
<p><div class="gatsby-resp-iframe-wrapper" style="padding-bottom: 56.49999999999999%; position: relative; height: 0; overflow: hidden; margin-bottom: 1.0725rem" > <div class="embedVideo-container"> <iframe title="" src="https://www.youtube.com/embed/wXB-V_Keiu8?rel=0" class="embedVideo-iframe" style="border:0; position: absolute; top: 0; left: 0; width: 100%; height: 100%; " loading="eager" allowfullscreen="" sandbox="allow-same-origin allow-scripts allow-popups"></iframe> </div> </div></p>
<h2 id="3---用-web-worker-处理加密" style="position:relative;"><a href="#3---%E7%94%A8-web-worker-%E5%A4%84%E7%90%86%E5%8A%A0%E5%AF%86" aria-label="3   用 web worker 处理加密 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>3 - 用 Web Worker 处理加密</h2>
<p>加密操作往往是计算密集型的。由于 Javascript 是单线程，在 UI 主线程上处理加密会导致浏览器卡顿几秒钟。</p>
<blockquote>
<p>将加密操作包装在 Promise 中也没用，因为 Promise 是在单线程中管理异步操作，而不是改善计算密集型任务的性能。</p>
</blockquote>
<p>为保证应用程序的性能，我们采用 <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Using_web_workers" target="_blank" rel="nofollow noopener noreferrer">Web Worker</a> 在浏览器单独的线程中执行加密运算。
我们将使用 <a href="https://github.com/travist/jsencrypt" target="_blank" rel="nofollow noopener noreferrer">JSEncrypt</a>，这是一个源自斯坦福的著名 Javascript RSA 实现。
使用 JSEncrypt 来创建一些帮助函数，用于加密、解密与生成密钥对。</p>
<h3 id="31---创建-web-worker-来包装-jsencrypt-方法" style="position:relative;"><a href="#31---%E5%88%9B%E5%BB%BA-web-worker-%E6%9D%A5%E5%8C%85%E8%A3%85-jsencrypt-%E6%96%B9%E6%B3%95" aria-label="31   创建 web worker 来包装 jsencrypt 方法 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>3.1 - 创建 Web Worker 来包装 JSEncrypt 方法</h3>
<p>在目录 <code class="language-text">public</code> 中新建文件 <code class="language-text">crypto-worker.js</code>。
这个文件存放 Web Worker 的代码，以便在一个单独的浏览器线程上执行加密操作。</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript">self<span class="token punctuation">.</span>window <span class="token operator">=</span> self <span class="token comment">// 在 Web Worker 中使用 JSEncrypt 库，这行是必须的</span>

<span class="token comment">// 导入 JSEncrypt 库</span>
self<span class="token punctuation">.</span><span class="token function">importScripts</span><span class="token punctuation">(</span><span class="token string">'https://cdnjs.cloudflare.com/ajax/libs/jsencrypt/2.3.1/jsencrypt.min.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> crypt <span class="token operator">=</span> <span class="token keyword">null</span>
<span class="token keyword">let</span> privateKey <span class="token operator">=</span> <span class="token keyword">null</span>

<span class="token comment">/** Web Worker onmessage 监听器 */</span>
<span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span> messageType<span class="token punctuation">,</span> messageId<span class="token punctuation">,</span> text<span class="token punctuation">,</span> key <span class="token punctuation">]</span> <span class="token operator">=</span> e<span class="token punctuation">.</span>data
  <span class="token keyword">let</span> result
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>messageType<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'generate-keys'</span><span class="token operator">:</span>
      result <span class="token operator">=</span> <span class="token function">generateKeypair</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">break</span>
    <span class="token keyword">case</span> <span class="token string">'encrypt'</span><span class="token operator">:</span>
      result <span class="token operator">=</span> <span class="token function">encrypt</span><span class="token punctuation">(</span>text<span class="token punctuation">,</span> key<span class="token punctuation">)</span>
      <span class="token keyword">break</span>
    <span class="token keyword">case</span> <span class="token string">'decrypt'</span><span class="token operator">:</span>
      result <span class="token operator">=</span> <span class="token function">decrypt</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span>
      <span class="token keyword">break</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 返回结果给 UI 线程</span>
  <span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token punctuation">[</span> messageId<span class="token punctuation">,</span> result <span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">/** 生成与储存密钥对 */</span>
<span class="token keyword">function</span> <span class="token function">generateKeypair</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  crypt <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JSEncrypt</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">default_key_size</span><span class="token operator">:</span> <span class="token number">2056</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  privateKey <span class="token operator">=</span> crypt<span class="token punctuation">.</span><span class="token function">getPrivateKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token comment">// 仅返回公钥，隐藏私钥</span>
  <span class="token keyword">return</span> crypt<span class="token punctuation">.</span><span class="token function">getPublicKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">/** 使用目标公钥加密字符串 */</span>
<span class="token keyword">function</span> <span class="token function">encrypt</span> <span class="token punctuation">(</span><span class="token parameter">content<span class="token punctuation">,</span> publicKey</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  crypt<span class="token punctuation">.</span><span class="token function">setKey</span><span class="token punctuation">(</span>publicKey<span class="token punctuation">)</span>
  <span class="token keyword">return</span> crypt<span class="token punctuation">.</span><span class="token function">encrypt</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">/** 使用本地私钥解密字符串 */</span>
<span class="token keyword">function</span> <span class="token function">decrypt</span> <span class="token punctuation">(</span><span class="token parameter">content</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  crypt<span class="token punctuation">.</span><span class="token function">setKey</span><span class="token punctuation">(</span>privateKey<span class="token punctuation">)</span>
  <span class="token keyword">return</span> crypt<span class="token punctuation">.</span><span class="token function">decrypt</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div>
<p>该 Web Worker 在 <code class="language-text">onmessage</code> 监听器中接收来自 UI 线程的消息，执行请求的操作，并返回结果到 UI 线程。
私钥永远不会直接暴露给 UI 线程，这有助于减少跨站脚本攻击(<a href="https://www.owasp.org/index.php/Cross-site_Scripting_(XSS)" target="_blank" rel="nofollow noopener noreferrer">XSS</a>)中私钥被盗的可能性。</p>
<h3 id="32---配置-vue-应用程序与-web-worker-通讯" style="position:relative;"><a href="#32---%E9%85%8D%E7%BD%AE-vue-%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E4%B8%8E-web-worker-%E9%80%9A%E8%AE%AF" aria-label="32   配置 vue 应用程序与 web worker 通讯 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>3.2 - 配置 Vue 应用程序与 Web Worker 通讯</h3>
<p>下面，我们配置 UI controller 与 Web Worker 通讯。
使用事件侦听器按顺序的调用/响应通信很难同步。
为简化，我们创建一个工具函数，将整个通讯周期包装到 Promise 中。
在 <code class="language-text">/public/page.js</code> 中的 <code class="language-text">methods</code> 代码块中添加如下。</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">/** 向 Web Worker 发消息，返回一个包含结果的 Promise。 */</span>
<span class="token function">getWebWorkerResponse</span> <span class="token punctuation">(</span><span class="token parameter">messageType<span class="token punctuation">,</span> messagePayload</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">// 生成一个随机消息 id 来标识相应的事件回调</span>
    <span class="token keyword">const</span> messageId <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100000</span><span class="token punctuation">)</span>

    <span class="token comment">// 发送消息给 Web Worker</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>cryptWorker<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token punctuation">[</span>messageType<span class="token punctuation">,</span> messageId<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>messagePayload<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment">// 为 Web Worker 消息事件创建句柄</span>
    <span class="token keyword">const</span> <span class="token function-variable function">handler</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 仅处理消息 id 匹配的消息</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> messageId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 监听器被调用后移除之</span>
        e<span class="token punctuation">.</span>currentTarget<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>type<span class="token punctuation">,</span> handler<span class="token punctuation">)</span>

        <span class="token comment">// Resolve the promise with the message payload.</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 将句柄分配给 Web Worker 'message' 事件。</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>cryptWorker<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> handler<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div>
<p>该代码允许我们在 Web Worker 线程中触发一个操作，并在 Promise 中接收返回结果。
在将调用/响应处理外包给 Web Worker 的任何项目中，这都是非常有用的帮助函数。</p>
<h2 id="4---密钥交换" style="position:relative;"><a href="#4---%E5%AF%86%E9%92%A5%E4%BA%A4%E6%8D%A2" aria-label="4   密钥交换 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>4 - 密钥交换</h2>
<p>在我们的应用中，第一步是为每个用户生成一对密钥。
然后一旦用户进入同一个对话，应用程序会交换用户的 <em>公钥</em>，这样每个用户就能解密属于自己的消息，而其他人只能加密。</p>
<p>因此，应用程序始终使用接收者的 <em>公钥</em> 来加密消息，使用用户自己的 <em>私钥</em> 解密消息。</p>
<h3 id="41---添加服务器端-socket-监听器来传递公钥" style="position:relative;"><a href="#41---%E6%B7%BB%E5%8A%A0%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF-socket-%E7%9B%91%E5%90%AC%E5%99%A8%E6%9D%A5%E4%BC%A0%E9%80%92%E5%85%AC%E9%92%A5" aria-label="41   添加服务器端 socket 监听器来传递公钥 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>4.1 - 添加服务器端 Socket 监听器来传递公钥</h3>
<p>在服务器端，需要一个 Socket 监听器接收从客户端发来的公钥，并将其广播给聊天室中其他人。
还需要一个监听器通知客户端，何人何时从当前聊天室中退出。</p>
<p>在 <code class="language-text">/app.js</code> 的 <code class="language-text">io.on('connection', (socket) => { ... }</code> 回调中添加监听器。</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">/** 广播公钥到聊天室 */</span>
socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'PUBLIC_KEY'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  socket<span class="token punctuation">.</span>broadcast<span class="token punctuation">.</span><span class="token function">to</span><span class="token punctuation">(</span>currentRoom<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'PUBLIC_KEY'</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">/** 广播断开连接到聊天室 */</span>
socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'disconnect'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  socket<span class="token punctuation">.</span>broadcast<span class="token punctuation">.</span><span class="token function">to</span><span class="token punctuation">(</span>currentRoom<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'USER_DISCONNECTED'</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div>
<h3 id="42---生成密钥对" style="position:relative;"><a href="#42---%E7%94%9F%E6%88%90%E5%AF%86%E9%92%A5%E5%AF%B9" aria-label="42   生成密钥对 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>4.2 - 生成密钥对</h3>
<p>下一步，替换 <code class="language-text">/public/page.js</code> 中的 <code class="language-text">created</code> 函数，用于初始化 Web Worker 和生成一对密钥。</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">async</span> <span class="token function">created</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addNotification</span><span class="token punctuation">(</span><span class="token string">'Welcome! Generating a new keypair now.'</span><span class="token punctuation">)</span>

  <span class="token comment">// Initialize crypto webworker thread</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>cryptWorker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token string">'crypto-worker.js'</span><span class="token punctuation">)</span>

  <span class="token comment">// Generate keypair and join default room</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>originPublicKey <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getWebWorkerResponse</span><span class="token punctuation">(</span><span class="token string">'generate-keys'</span><span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addNotification</span><span class="token punctuation">(</span><span class="token string">'Keypair Generated'</span><span class="token punctuation">)</span>

  <span class="token comment">// Initialize socketio</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>socket <span class="token operator">=</span> <span class="token function">io</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setupSocketListeners</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre></div>
<p>这里使用 <a href="https://blog.patricktriest.com/what-is-async-await-why-should-you-care/" target="_blank" rel="nofollow noopener noreferrer">async/await 语法</a> 在一行代码中接收 Web Worker 返回的 Promise。</p>
<h3 id="43---添加公钥帮助函数" style="position:relative;"><a href="#43---%E6%B7%BB%E5%8A%A0%E5%85%AC%E9%92%A5%E5%B8%AE%E5%8A%A9%E5%87%BD%E6%95%B0" aria-label="43   添加公钥帮助函数 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>4.3 - 添加公钥帮助函数</h3>
<p>还要在 <code class="language-text">/public/page.js</code> 添加一些函数用于发送公钥，并将密钥简化为人类可读的标识符。</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">/** 发送公钥给聊天室中所有用户 */</span>
<span class="token function">sendPublicKey</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>originPublicKey<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>socket<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'PUBLIC_KEY'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>originPublicKey<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>

<span class="token comment">/** 获取用于显示的密钥片段 */</span>
<span class="token function">getKeySnippet</span> <span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> key<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> <span class="token number">416</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre></div>
<h3 id="44---收发公钥" style="position:relative;"><a href="#44---%E6%94%B6%E5%8F%91%E5%85%AC%E9%92%A5" aria-label="44   收发公钥 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>4.4 - 收发公钥</h3>
<p>下面在客户端 Socket 代码中添加一些监听器，用于当有新用户加入聊天室时发送本地公钥，并保存接收到的其他用户的公钥。</p>
<p>在 <code class="language-text">/public/page.js</code> 的 <code class="language-text">setupSocketListeners</code> 函数处添加如下。</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// 有新用户加入当前聊天室时，向他发送你的公钥</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'NEW_CONNECTION'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addNotification</span><span class="token punctuation">(</span><span class="token string">'Another user joined the room.'</span><span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">sendPublicKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 加入一个聊天室时广播公钥</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'ROOM_JOINED'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">newRoom</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>currentRoom <span class="token operator">=</span> newRoom
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addNotification</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Joined Room - </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>currentRoom<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">sendPublicKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 收到公钥时保存之</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'PUBLIC_KEY'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addNotification</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Public Key Received - </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getKeySnippet</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>destinationPublicKey <span class="token operator">=</span> key
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 有用户离开聊天室时删除用户对应公钥</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'user disconnected'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">User Disconnected - </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getKeySnippet</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>destinationKey<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>destinationPublicKey <span class="token operator">=</span> <span class="token keyword">null</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div>
<h3 id="45---在-ui-中显示公钥" style="position:relative;"><a href="#45---%E5%9C%A8-ui-%E4%B8%AD%E6%98%BE%E7%A4%BA%E5%85%AC%E9%92%A5" aria-label="45   在 ui 中显示公钥 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>4.5 - 在 UI 中显示公钥</h3>
<p>最后，添加一些 HTML 用于显示两个公钥。</p>
<p>在 <code class="language-text">/public/index.html</code> 的 <code class="language-text">&lt;!-- Add Encryption Key UI Here --></code> 注释后添加如下。</p>
<div class="gatsby-highlight" data-language="html"><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>divider<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>keys full-width<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>KEYS<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>THEIR PUBLIC KEY<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>key red<span class="token punctuation">"</span></span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>destinationPublicKey<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">></span></span>TRUNCATED IDENTIFIER - {{ getKeySnippet(destinationPublicKey) }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>{{ destinationPublicKey }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span> <span class="token attr-name">v-else</span><span class="token punctuation">></span></span>Waiting for second user to join room...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>divider<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>YOUR PUBLIC KEY<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>key green<span class="token punctuation">"</span></span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>originPublicKey<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">></span></span>TRUNCATED IDENTIFIER - {{ getKeySnippet(originPublicKey) }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>{{ originPublicKey }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>keypair-loader full-width<span class="token punctuation">"</span></span> <span class="token attr-name">v-else</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>center-x loader<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>center-text<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Generating Keypair...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre></div>
<p>重启应用程序并刷新 <code class="language-text">http://localhost:3000</code>。
打开两个浏览器标签页，应该就能成功模拟一次密钥交换。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 760px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/b8bb4c638be1fd2cfeb13a2f87ab8cf8/67c4b/screenshot_4.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 55.78947368421052%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA2ElEQVR42pWSTW7DIBCFfYAa5geMAcsVpCaWrTS77rtspKj3v02nthp1VdOnt0Ezj28G0eCRiOh8nkspKSXvfQjBGAMAUmqOssDM67pK8vp6LdNEm/ZaU0M+5RyH4bRpHJ+ttZVk3FF79+P4D3KIka1FZjH9WFQRlp1zfun7EdEjGsRus60hC/pd61v79KHVXalPpd60jgChcuyL7Ra2BXlCnpETcS+TV4Zt9pRcO2AbsfWoHIL5dkNHkoehmdSiYQFYAS6AGamTK6lxzsmP4T9lesOPll+9X3fyMyV7m2ZtAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/b8bb4c638be1fd2cfeb13a2f87ab8cf8/5ed05/screenshot_4.webp 190w,
/static/b8bb4c638be1fd2cfeb13a2f87ab8cf8/9d76b/screenshot_4.webp 380w,
/static/b8bb4c638be1fd2cfeb13a2f87ab8cf8/33466/screenshot_4.webp 760w,
/static/b8bb4c638be1fd2cfeb13a2f87ab8cf8/ca244/screenshot_4.webp 1140w,
/static/b8bb4c638be1fd2cfeb13a2f87ab8cf8/34e40/screenshot_4.webp 1440w"
              sizes="(max-width: 760px) 100vw, 760px"
              type="image/webp"
            />
          <source
            srcset="/static/b8bb4c638be1fd2cfeb13a2f87ab8cf8/253c6/screenshot_4.png 190w,
/static/b8bb4c638be1fd2cfeb13a2f87ab8cf8/810ee/screenshot_4.png 380w,
/static/b8bb4c638be1fd2cfeb13a2f87ab8cf8/b4918/screenshot_4.png 760w,
/static/b8bb4c638be1fd2cfeb13a2f87ab8cf8/c0204/screenshot_4.png 1140w,
/static/b8bb4c638be1fd2cfeb13a2f87ab8cf8/67c4b/screenshot_4.png 1440w"
            sizes="(max-width: 760px) 100vw, 760px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/b8bb4c638be1fd2cfeb13a2f87ab8cf8/b4918/screenshot_4.png"
            alt="Screenshot 4"
            title=""
            loading="lazy"
            decoding="async"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<blockquote>
<p>在多于两个标签页中打开应用，交换密钥应该会失败。我们将进一步解决此问题。</p>
</blockquote>
<h2 id="5---消息加密" style="position:relative;"><a href="#5---%E6%B6%88%E6%81%AF%E5%8A%A0%E5%AF%86" aria-label="5   消息加密 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>5 - 消息加密</h2>
<p>现在密钥交换已完成，加密、解密消息就很简单了。</p>
<h3 id="51---发送前加密消息" style="position:relative;"><a href="#51---%E5%8F%91%E9%80%81%E5%89%8D%E5%8A%A0%E5%AF%86%E6%B6%88%E6%81%AF" aria-label="51   发送前加密消息 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>5.1 - 发送前加密消息</h3>
<p>替换 <code class="language-text">/public/page.js</code> 中的 <code class="language-text">sendMessage</code> 函数为如下。</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">/** 加密并发送当前消息 */</span>
<span class="token keyword">async</span> <span class="token function">sendMessage</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 消息为空时不发送</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>draft <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>draft <span class="token operator">===</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span>

  <span class="token comment">// 使用 Immutable.js来避免意外的副作用。</span>
  <span class="token keyword">let</span> message <span class="token operator">=</span> Immutable<span class="token punctuation">.</span><span class="token function">Map</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>draft<span class="token punctuation">,</span>
    <span class="token literal-property property">recipient</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>destinationPublicKey<span class="token punctuation">,</span>
    <span class="token literal-property property">sender</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>originPublicKey
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">// 重置输入文本</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>draft <span class="token operator">=</span> <span class="token string">''</span>

  <span class="token comment">// 立即将(未加密的)消息显示到本地 UI</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">toObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>destinationPublicKey<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 使用其他用户的公钥加密消息</span>
    <span class="token keyword">const</span> encryptedText <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getWebWorkerResponse</span><span class="token punctuation">(</span>
      <span class="token string">'encrypt'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span> message<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'text'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>destinationPublicKey <span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> encryptedMsg <span class="token operator">=</span> message<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'text'</span><span class="token punctuation">,</span> encryptedText<span class="token punctuation">)</span>

    <span class="token comment">// 发送加密的消息</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>socket<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'MESSAGE'</span><span class="token punctuation">,</span> encryptedMsg<span class="token punctuation">.</span><span class="token function">toObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre></div>
<h3 id="52---接收与解密消息" style="position:relative;"><a href="#52---%E6%8E%A5%E6%94%B6%E4%B8%8E%E8%A7%A3%E5%AF%86%E6%B6%88%E6%81%AF" aria-label="52   接收与解密消息 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>5.2 - 接收与解密消息</h3>
<p>修改 <code class="language-text">/public/page.js</code> 中的 <code class="language-text">message</code> 监听器，用于解密接收到的消息。</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// 解密与显示接收到的消息</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'MESSAGE'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// 仅解密用用户公钥加密的消息</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>message<span class="token punctuation">.</span>recipient <span class="token operator">===</span> <span class="token keyword">this</span><span class="token punctuation">.</span>originPublicKey<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 在 Web Worker 线程中解密消息</span>
    message<span class="token punctuation">.</span>text <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getWebWorkerResponse</span><span class="token punctuation">(</span><span class="token string">'decrypt'</span><span class="token punctuation">,</span> message<span class="token punctuation">.</span>text<span class="token punctuation">)</span>

    <span class="token comment">// 立即将(未加密的)消息显示到本地 UI</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div>
<h3 id="53---显示消息列表" style="position:relative;"><a href="#53---%E6%98%BE%E7%A4%BA%E6%B6%88%E6%81%AF%E5%88%97%E8%A1%A8" aria-label="53   显示消息列表 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>5.3 - 显示消息列表</h3>
<p>修改 <code class="language-text">/public/index.html</code> 中的消息列表 UI(在 <code class="language-text">chat-container</code> 中)，来显示解密的消息和发送者公钥的缩写。</p>
<div class="gatsby-highlight" data-language="html"><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>message full-width<span class="token punctuation">"</span></span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>message in messages<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name"><span class="token namespace">v-bind:</span>class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>(message.sender == originPublicKey) ? 'green' : 'red'<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>{{ getKeySnippet(message.sender) }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>
    > {{ message.text }}
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre></div>
<h3 id="54---试试看" style="position:relative;"><a href="#54---%E8%AF%95%E8%AF%95%E7%9C%8B" aria-label="54   试试看 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>5.4 - 试试看</h3>
<p>重启服务并刷新 <a href="http://localhost:3000" target="_blank" rel="nofollow noopener noreferrer"><code class="language-text">http://localhost:3000</code></a>。
UI 界面应该看起来跟之前没有变化，除了会显示每个消息发送者的公钥片段。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 760px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/3ddcd4f7188d7a9818daab8d83e1442b/67c4b/screenshot_5.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 55.78947368421052%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA9UlEQVR42o2R226DMAyG8wCD+BDnRIeADphoK+52vetqe//XmaFb14tu5ZMVxXHs35ZN420TuWka7wPeg4jGcRyGoW3blFLO2TkHABoyo4NeaN8tpBgvr7cw82GatPo8z33fay2k75DBgORJS4agN7qrrKVzVe1X6rr+VUY9AWHlr7aVa/Ti/ig/Qr+qLIsQs85AN7YhWWfuupcYa8SMKIh+Ndmo/G7tuXj6sOVnudibtRVAtTH5JP7IMiD3yHq2xJGYYFuydInaUDxjscMiYRkQtGmHhh6he6ZXspOFA8AR4ATYLdslIaPr1b3xv7joWK7OaitfZ/M0Zc6o4mYAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/3ddcd4f7188d7a9818daab8d83e1442b/5ed05/screenshot_5.webp 190w,
/static/3ddcd4f7188d7a9818daab8d83e1442b/9d76b/screenshot_5.webp 380w,
/static/3ddcd4f7188d7a9818daab8d83e1442b/33466/screenshot_5.webp 760w,
/static/3ddcd4f7188d7a9818daab8d83e1442b/ca244/screenshot_5.webp 1140w,
/static/3ddcd4f7188d7a9818daab8d83e1442b/34e40/screenshot_5.webp 1440w"
              sizes="(max-width: 760px) 100vw, 760px"
              type="image/webp"
            />
          <source
            srcset="/static/3ddcd4f7188d7a9818daab8d83e1442b/253c6/screenshot_5.png 190w,
/static/3ddcd4f7188d7a9818daab8d83e1442b/810ee/screenshot_5.png 380w,
/static/3ddcd4f7188d7a9818daab8d83e1442b/b4918/screenshot_5.png 760w,
/static/3ddcd4f7188d7a9818daab8d83e1442b/c0204/screenshot_5.png 1140w,
/static/3ddcd4f7188d7a9818daab8d83e1442b/67c4b/screenshot_5.png 1440w"
            sizes="(max-width: 760px) 100vw, 760px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/3ddcd4f7188d7a9818daab8d83e1442b/b4918/screenshot_5.png"
            alt="Screenshot 5"
            title=""
            loading="lazy"
            decoding="async"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span><br>
<span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 760px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/157fcb94638099c9cea089014baaa17d/67c4b/screenshot_6.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 15.789473684210527%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAIAAAAcOLh5AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAhElEQVR42lWNQQ/CIAyFueC4M0VCQlYTnMmMMK8cpGid/v8/ZEe87Mtr+vL6kooQzt57ABjHS9/vpZTdFqXU1qtu9w9FzrkUXD5fooXojbUiT30hPsujOSJE5A4rhABwGgb+Bc45MU1X5rYSU0oxJl73RkxzXLOZT80ka605GGOOLK31D0LFGkEYvcrnAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/157fcb94638099c9cea089014baaa17d/5ed05/screenshot_6.webp 190w,
/static/157fcb94638099c9cea089014baaa17d/9d76b/screenshot_6.webp 380w,
/static/157fcb94638099c9cea089014baaa17d/33466/screenshot_6.webp 760w,
/static/157fcb94638099c9cea089014baaa17d/ca244/screenshot_6.webp 1140w,
/static/157fcb94638099c9cea089014baaa17d/34e40/screenshot_6.webp 1440w"
              sizes="(max-width: 760px) 100vw, 760px"
              type="image/webp"
            />
          <source
            srcset="/static/157fcb94638099c9cea089014baaa17d/253c6/screenshot_6.png 190w,
/static/157fcb94638099c9cea089014baaa17d/810ee/screenshot_6.png 380w,
/static/157fcb94638099c9cea089014baaa17d/b4918/screenshot_6.png 760w,
/static/157fcb94638099c9cea089014baaa17d/c0204/screenshot_6.png 1140w,
/static/157fcb94638099c9cea089014baaa17d/67c4b/screenshot_6.png 1440w"
            sizes="(max-width: 760px) 100vw, 760px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/157fcb94638099c9cea089014baaa17d/b4918/screenshot_6.png"
            alt="Screenshot 6"
            title=""
            loading="lazy"
            decoding="async"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>在命令行输出中，消息已不再可读 —— 它们现在显示为乱码的加密文本。</p>
<h2 id="6---聊天室" style="position:relative;"><a href="#6---%E8%81%8A%E5%A4%A9%E5%AE%A4" aria-label="6   聊天室 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>6 - 聊天室</h2>
<p>你大概已经注意到当前应用程序的一个重大缺陷 —— 如果在第三个标签页中打开该应用会使加密系统挂掉。
非对称加密被设计用于一对一的场景；无法加密消息 <em>一次</em> 然后分别被 <em>两个</em> 用户解密。</p>
<p>两个选择 ——</p>
<ol>
<li>若有多个用户，为每个用户分别加密并发送消息副本。</li>
<li>限制同一时间聊天室中最多有两个用户。</li>
</ol>
<p>由于本教程已经够长了，我们选择第二个简单的选项。</p>
<h3 id="61---进入聊天室的服务器端逻辑" style="position:relative;"><a href="#61---%E8%BF%9B%E5%85%A5%E8%81%8A%E5%A4%A9%E5%AE%A4%E7%9A%84%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF%E9%80%BB%E8%BE%91" aria-label="61   进入聊天室的服务器端逻辑 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>6.1 - 进入聊天室的服务器端逻辑</h3>
<p>为执行两个用户限制，修改 <code class="language-text">/app.js</code> 中的服务器端 <code class="language-text">JOIN</code> Socket 监听器，在 Socket 连接监听器代码块的上面加入如下。</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// 保存 Socket 连接到的聊天室</span>
<span class="token comment">// 如果需要横向扩展应用程序，需将此变量存储在诸如 Redis 之类的持久存储中。</span>
<span class="token comment">// 详情见： https://github.com/socketio/socket.io-redis</span>
<span class="token keyword">let</span> currentRoom <span class="token operator">=</span> <span class="token keyword">null</span>

<span class="token comment">/** 处理进入聊天室的请求 */</span>
socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'JOIN'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">roomName</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// 获取聊天室信息</span>
  <span class="token keyword">let</span> room <span class="token operator">=</span> io<span class="token punctuation">.</span>sockets<span class="token punctuation">.</span>adapter<span class="token punctuation">.</span>rooms<span class="token punctuation">[</span>roomName<span class="token punctuation">]</span>

  <span class="token comment">// 若聊天室已经有多于 1 的连接，则拒绝进入</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>room <span class="token operator">&amp;&amp;</span> room<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 通知用户进入聊天室请求被拒绝</span>
    io<span class="token punctuation">.</span><span class="token function">to</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'ROOM_FULL'</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span>

    <span class="token comment">// 通知聊天室有用户进</span>
    socket<span class="token punctuation">.</span>broadcast<span class="token punctuation">.</span><span class="token function">to</span><span class="token punctuation">(</span>roomName<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'INTRUSION_ATTEMPT'</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// 离开当前聊天室</span>
    socket<span class="token punctuation">.</span><span class="token function">leave</span><span class="token punctuation">(</span>currentRoom<span class="token punctuation">)</span>

    <span class="token comment">// 通知聊天室用户已离开</span>
    socket<span class="token punctuation">.</span>broadcast<span class="token punctuation">.</span><span class="token function">to</span><span class="token punctuation">(</span>currentRoom<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'USER_DISCONNECTED'</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span>

    <span class="token comment">// 进入新聊天室</span>
    currentRoom <span class="token operator">=</span> roomName
    socket<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>currentRoom<span class="token punctuation">)</span>

    <span class="token comment">// 通知用户进入聊天室成功</span>
    io<span class="token punctuation">.</span><span class="token function">to</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'ROOM_JOINED'</span><span class="token punctuation">,</span> currentRoom<span class="token punctuation">)</span>

    <span class="token comment">// 通知聊天室用户进入成功</span>
    socket<span class="token punctuation">.</span>broadcast<span class="token punctuation">.</span><span class="token function">to</span><span class="token punctuation">(</span>currentRoom<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'NEW_CONNECTION'</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div>
<p>修改这段 Socket 逻辑，防止用户进入一个已有两位用户的聊天室。</p>
<h3 id="62---通过客户端进入聊天室" style="position:relative;"><a href="#62---%E9%80%9A%E8%BF%87%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%BF%9B%E5%85%A5%E8%81%8A%E5%A4%A9%E5%AE%A4" aria-label="62   通过客户端进入聊天室 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>6.2 - 通过客户端进入聊天室</h3>
<p>修改客户端 <code class="language-text">/public/page.js</code> 中的 <code class="language-text">joinRoom</code> 函数，使切换聊天室时重置聊天状态。</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">/** 进入指定的聊天室 */</span>
<span class="token function">joinRoom</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>pendingRoom <span class="token operator">!==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>currentRoom <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>originPublicKey<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addNotification</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Connecting to Room - </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>pendingRoom<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>

    <span class="token comment">// 重置聊天室状态变量</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>messages <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>destinationPublicKey <span class="token operator">=</span> <span class="token keyword">null</span>

    <span class="token comment">// 发送进入聊天室请求</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>socket<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'JOIN'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pendingRoom<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre></div>
<h3 id="63---添加通知" style="position:relative;"><a href="#63---%E6%B7%BB%E5%8A%A0%E9%80%9A%E7%9F%A5" aria-label="63   添加通知 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>6.3 - 添加通知</h3>
<p>创建两个客户端 Socket 监听器(在 <code class="language-text">/public/page.js</code> 的 <code class="language-text">setupSocketListeners</code> 函数中)，当进入聊天室请求被拒绝时发出通知。</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// 通知用户试图加入的聊天室已满</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'ROOM_FULL'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addNotification</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Cannot join </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>pendingRoom<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, room is full</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>

  <span class="token comment">// 加入一个随机聊天室作为后备</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>pendingRoom <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">joinRoom</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 通知聊天室有人试图加入</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'INTRUSION_ATTEMPT'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addNotification</span><span class="token punctuation">(</span><span class="token string">'A third user attempted to join the room.'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div>
<h3 id="64---添加进入聊天室-ui" style="position:relative;"><a href="#64---%E6%B7%BB%E5%8A%A0%E8%BF%9B%E5%85%A5%E8%81%8A%E5%A4%A9%E5%AE%A4-ui" aria-label="64   添加进入聊天室 ui permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>6.4 - 添加进入聊天室 UI</h3>
<p>最后，添加一些 HTML，为用户提供一个界面来加入他们选择的房间。</p>
<p>在 <code class="language-text">/public/index.html</code> 的 <code class="language-text">&lt;!-- Add Room UI Here --></code> 注释处添加如下。</p>
<div class="gatsby-highlight" data-language="html"><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>CHATROOM<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>room-select<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>full-width<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Room Name<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>room-input<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>pendingRoom<span class="token punctuation">"</span></span> <span class="token attr-name">@keyup.enter</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>joinRoom()<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>yellow-button full-width<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">v-on:</span>click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>joinRoom()<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>JOIN<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>divider<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre></div>
<h3 id="65---自动滚动" style="position:relative;"><a href="#65---%E8%87%AA%E5%8A%A8%E6%BB%9A%E5%8A%A8" aria-label="65   自动滚动 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>6.5 - 自动滚动</h3>
<p>应用程序中还有个烦人的 bug，即通知和聊天列表尚未自动滚动以显示新消息。</p>
<p>在 <code class="language-text">/public/page.js</code> 的 <code class="language-text">methods</code> 代码块中添加如下函数。</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">/** 自动滚动 DOM 元素到底部 */</span>
<span class="token function">autoscroll</span> <span class="token punctuation">(</span><span class="token parameter">element</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>element<span class="token punctuation">)</span> <span class="token punctuation">{</span> element<span class="token punctuation">.</span>scrollTop <span class="token operator">=</span> element<span class="token punctuation">.</span>scrollHeight <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre></div>
<p>要自动滚动通知和消息列表，我们将在 <code class="language-text">add</code> 方法的末尾调用 <code class="language-text">autoscroll</code>。</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">/** 将消息添加到 UI 并滚动视图以显示新消息。 */</span>
<span class="token function">addMessage</span> <span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>messages<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">autoscroll</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>chatContainer<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>

<span class="token comment">/** 在 UI 中添加通知消息 */</span>
<span class="token function">addNotification</span> <span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> timestamp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLocaleTimeString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>notifications<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token punctuation">,</span> timestamp <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">autoscroll</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>notificationContainer<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre></div>
<h3 id="66---试试看" style="position:relative;"><a href="#66---%E8%AF%95%E8%AF%95%E7%9C%8B" aria-label="66   试试看 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>6.6 - 试试看</h3>
<p>最后一步！重启 Node 应用程序并刷新 <a href="http://localhost:3000" target="_blank" rel="nofollow noopener noreferrer"><code class="language-text">localhost:3000</code></a>。
现在应该可以自由地在不同聊天室间切换，从第三个浏览器标签页加入同一聊天室的任何尝试都将被拒绝。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 760px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/8aabb20a82040a8b5e0a929d10f599fe/67c4b/screenshot_7.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 55.78947368421052%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAABHUlEQVR42o2SzW6DMBCE/QKxvbM2/glB4BQCSRV66rnXqmrf/3G6gHpKlPTT3LzjnV1bFWdK4LZtQwh0D4CHYajrGoDzTkgZeQ9mqJ7ti0e7EkOw1t6YcVpZCmLMOcfkQmTnWL2xnitM4zSOo6+qWzMzXy6XUsr1ei1d8d5Llq1K9c70gQ+HgwSTg/vm81nazvM8TVOKUbJsR2rHpJmMtcaYW+cWu2kaCdy1XdeVYynhbzoll4AeIeaQEpwzgBWtYbBK0TOk6LWUPsYGlAGZuAJVRF4603M3Poz50rtPo7+1/tH63ZjaWtE/OgPyDBP7gdATToQWHCTCMvMzZNvhuHcl6hp6D51gIyiAPJSsTj4NP0ZeJxIn5rwqMvtFv3dINtirv53jAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/8aabb20a82040a8b5e0a929d10f599fe/5ed05/screenshot_7.webp 190w,
/static/8aabb20a82040a8b5e0a929d10f599fe/9d76b/screenshot_7.webp 380w,
/static/8aabb20a82040a8b5e0a929d10f599fe/33466/screenshot_7.webp 760w,
/static/8aabb20a82040a8b5e0a929d10f599fe/ca244/screenshot_7.webp 1140w,
/static/8aabb20a82040a8b5e0a929d10f599fe/34e40/screenshot_7.webp 1440w"
              sizes="(max-width: 760px) 100vw, 760px"
              type="image/webp"
            />
          <source
            srcset="/static/8aabb20a82040a8b5e0a929d10f599fe/253c6/screenshot_7.png 190w,
/static/8aabb20a82040a8b5e0a929d10f599fe/810ee/screenshot_7.png 380w,
/static/8aabb20a82040a8b5e0a929d10f599fe/b4918/screenshot_7.png 760w,
/static/8aabb20a82040a8b5e0a929d10f599fe/c0204/screenshot_7.png 1140w,
/static/8aabb20a82040a8b5e0a929d10f599fe/67c4b/screenshot_7.png 1440w"
            sizes="(max-width: 760px) 100vw, 760px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/8aabb20a82040a8b5e0a929d10f599fe/b4918/screenshot_7.png"
            alt="Screenshot 7"
            title=""
            loading="lazy"
            decoding="async"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<h2 id="7---接下来" style="position:relative;"><a href="#7---%E6%8E%A5%E4%B8%8B%E6%9D%A5" aria-label="7   接下来 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>7 - 接下来？</h2>
<p>恭喜！您已经构建了一个功能完整的端到端加密消息收发应用程序。</p>
<ul>
<li>演示 - <a href="https://chat.patricktriest.com" target="_blank" rel="nofollow noopener noreferrer">https://chat.patricktriest.com</a></li>
<li>Github 仓库 - <a href="https://github.com/triestpa/Open-Cryptochat" target="_blank" rel="nofollow noopener noreferrer">https://github.com/triestpa/Open-Cryptochat</a></li>
</ul>
<p>以该代码为基础，您可以在自己的服务器上部署一个私有消息收发应用程序。
为协调在哪个聊天室见面，一个巧妙的选择是使用基于时间的伪随机数生成器(如 <a href="https://play.google.com/store/apps/details?id=com.google.android.apps.authenticator2&#x26;hl=en" target="_blank" rel="nofollow noopener noreferrer">Google Authenticator</a>)，
你和对方共享一个 seed(Javascript “Google Authenticator” 教程我正在写，保持关注)。</p>
<h3 id="更进一步" style="position:relative;"><a href="#%E6%9B%B4%E8%BF%9B%E4%B8%80%E6%AD%A5" aria-label="更进一步 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>更进一步</h3>
<p>以此为起点可以做很多应用：</p>
<ul>
<li>群聊，通过存储多个公钥，并分别为每个用户加密消息。</li>
<li>多媒体消息，通过加密一个包含媒体文件的字节数组。</li>
<li>将密钥对导入和导出为本地文件。</li>
<li>使用发送方身份验证的私钥对消息进行签名。这是一种折衷，因为它增加了伪造消息的难度，但也破坏了 OTR消息传递标准(<a href="https://en.wikipedia.org/wiki/Off-the-Record_Messaging" target="_blank" rel="nofollow noopener noreferrer">OTR messaging standard</a>)中概述的“可拒绝身份验证”的目标。</li>
<li>尝试不同的加密系统，如：
<ul>
<li><a href="https://en.wikipedia.org/wiki/Advanced_Encryption_Standard" target="_blank" rel="nofollow noopener noreferrer"><strong>AES</strong></a> - 对称加密，用户之间共享秘密。这是 NSA 和美国军方使用的唯一公开可用的算法。</li>
<li><a href="https://en.wikipedia.org/wiki/ElGamal_encryption" target="_blank" rel="nofollow noopener noreferrer"><strong>ElGamal</strong></a> - 类似于 RSA，但具有更小的密码文本、更快的解密和更慢的加密。这是在PGP中使用的核心算法。</li>
<li>实现一个  <a href="https://en.wikipedia.org/wiki/Diffie%E2%80%93Hellman_key_exchange" target="_blank" rel="nofollow noopener noreferrer"><strong>Diffie-Helman</strong></a> 密钥交换。这是一种使用非对称加密(例如 ElGamal)交换共享密钥的技术。在现有项目基础上构建，并在发送每条消息之前交换新的共享密钥是提高应用程序安全性的一种好方法(请参阅 <a href="https://en.wikipedia.org/wiki/Forward_secrecy" target="_blank" rel="nofollow noopener noreferrer">Perfect Forward Security</a>)。</li>
</ul>
</li>
<li>建立一个应用程序，在任何情况下，中间服务器绝不应有未加密的访问，如密码管理器和 P2P(点对点) 网络。</li>
<li>为 <a href="https://facebook.github.io/react-native/" target="_blank" rel="nofollow noopener noreferrer">React Native</a>，<a href="https://ionicframework.com/" target="_blank" rel="nofollow noopener noreferrer">Ionic</a>，<a href="https://cordova.apache.org/" target="_blank" rel="nofollow noopener noreferrer">Cordova</a> 或 <a href="https://electronjs.org/" target="_blank" rel="nofollow noopener noreferrer">Electron</a> 重构应用程序，以便为移动和/或桌面环境提供安全的预构建应用程序包。</li>
</ul>
<p>请在下面随意评论有关本教程的问题，反馈和/或反馈。</p>
<hr>
<p><a id="fn1"></a></p>
<ol>
<li><strong>基于浏览器的加密安全隐患</strong></li>
</ol>
<p>请谨记。在基于浏览器的 Javascript 应用程序中使用这些协议是试验和了解它们在实际中如何工作的好方法，但此应用程序不适合替代已建立的，经过同行评审的加密协议实现，例如 <a href="https://en.wikipedia.org/wiki/OpenSSL" target="_blank" rel="nofollow noopener noreferrer">OpenSSL</a> 和 <a href="https://en.wikipedia.org/wiki/GNU_Privacy_Guard" target="_blank" rel="nofollow noopener noreferrer">GnuPG</a>。</p>
<p>客户端浏览器 Javascript 加密在安全专家中是个有争议的话题，因为 Web 应用程序交付相比在浏览器外运行的预打包软件存在漏洞。
可通过使用 HTTPS 防止中间人资源注入攻击，并通过避免在浏览器中持久存储未加密的敏感数据来缓解这些问题，但务必注意 Web 平台中潜在的漏洞。<a href="#fnref1">↩</a></p>
<hr>
<p>相关参考：</p>
<ul>
<li><a href="https://www.ruanyifeng.com/blog/2013/06/rsa_algorithm_part_one.html" target="_blank" rel="nofollow noopener noreferrer">RSA算法原理（一） - 阮一峰</a></li>
<li><a href="http://travistidwell.com/jsencrypt/" target="_blank" rel="nofollow noopener noreferrer">JSEncrypt - OpenSSL RSA 加密的 Javascript 实现</a></li>
<li><a href="https://prism-break.org/zh-CN/" target="_blank" rel="nofollow noopener noreferrer">prism-break.org 推荐的加密通信软件</a></li>
<li><a href="https://github.com/mdrights/Digital-rights/blob/master/E%E5%8A%A0%E5%AF%86%E6%8A%80%E8%A1%93/2019-09-21-%E4%BD%A0%E7%9C%9F%E7%9A%84%E4%BA%86%E8%A7%A3%E7%AB%AF%E5%88%B0%E7%AB%AF%E5%8A%A0%E5%AF%86%E4%B9%88.md" target="_blank" rel="nofollow noopener noreferrer">你真的了解端到端加密么？</a></li>
<li><a href="https://openpgpjs.org/" target="_blank" rel="nofollow noopener noreferrer">OpenPGP.js - OpenPGP 的 Javascript 实现</a></li>
</ul></div><div class="Post-tagList MuiBox-root css-1yuhvjn"><a class="MuiButtonBase-root MuiChip-root MuiChip-outlined MuiChip-sizeMedium MuiChip-colorDefault MuiChip-clickable MuiChip-clickableColorDefault MuiChip-outlinedDefault Post-chip css-wwkjos" tabindex="0" href="/tag/javascript/"><span class="MuiChip-label MuiChip-labelMedium css-qbwvub">Javascript</span></a><a class="MuiButtonBase-root MuiChip-root MuiChip-outlined MuiChip-sizeMedium MuiChip-colorDefault MuiChip-clickable MuiChip-clickableColorDefault MuiChip-outlinedDefault Post-chip css-wwkjos" tabindex="0" href="/tag/node-js/"><span class="MuiChip-label MuiChip-labelMedium css-qbwvub">Node.js</span></a><a class="MuiButtonBase-root MuiChip-root MuiChip-outlined MuiChip-sizeMedium MuiChip-colorDefault MuiChip-clickable MuiChip-clickableColorDefault MuiChip-outlinedDefault Post-chip css-wwkjos" tabindex="0" href="/tag/公钥加密/"><span class="MuiChip-label MuiChip-labelMedium css-qbwvub">公钥加密</span></a><a class="MuiButtonBase-root MuiChip-root MuiChip-outlined MuiChip-sizeMedium MuiChip-colorDefault MuiChip-clickable MuiChip-clickableColorDefault MuiChip-outlinedDefault Post-chip css-wwkjos" tabindex="0" href="/tag/教程/"><span class="MuiChip-label MuiChip-labelMedium css-qbwvub">教程</span></a><a class="MuiButtonBase-root MuiChip-root MuiChip-outlined MuiChip-sizeMedium MuiChip-colorDefault MuiChip-clickable MuiChip-clickableColorDefault MuiChip-outlinedDefault Post-chip css-wwkjos" tabindex="0" href="/tag/翻译/"><span class="MuiChip-label MuiChip-labelMedium css-qbwvub">翻译</span></a></div><div class="MuiBox-root css-13dgk6d"><h2 class="MuiTypography-root MuiTypography-h6 css-1cef0gz">分享</h2><button tabindex="0" role="button" class="react-share__ShareButton MuiButtonBase-root Post-shareButton css-hkx3jt"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-q7mezt" focusable="false" aria-hidden="true" viewBox="0 0 263 448"><path d="M239.75 3v66h-39.25c-30.75 0-36.5 14.75-36.5 36v47.25h73.25l-9.75 74h-63.5v189.75h-76.5v-189.75h-63.75v-74h63.75v-54.5c0-63.25 38.75-97.75 95.25-97.75 27 0 50.25 2 57 3z"></path></svg></button><button tabindex="0" role="button" class="react-share__ShareButton MuiButtonBase-root Post-shareButton css-hkx3jt"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-q7mezt" focusable="false" aria-hidden="true" viewBox="0 0 1200 1227"><path d="M714.163 519.284L1160.89 0H1055.03L667.137 450.887L357.328 0H0L468.492 681.821L0 1226.37H105.866L515.491 750.218L842.672 1226.37H1200L714.137 519.284H714.163ZM569.165 687.828L521.697 619.934L144.011 79.6944H306.615L611.412 515.685L658.88 583.579L1055.08 1150.3H892.476L569.165 687.854V687.828Z"></path></svg></button><button tabindex="0" role="button" class="react-share__ShareButton MuiButtonBase-root Post-shareButton css-hkx3jt"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-q7mezt" focusable="false" aria-hidden="true" viewBox="0 0 384 448"><path d="M87.25 156.25v247.75h-82.5v-247.75h82.5zM92.5 79.75c0.25 23.75-17.75 42.75-46.5 42.75v0h-0.5c-27.75 0-45.5-19-45.5-42.75 0-24.25 18.5-42.75 46.5-42.75 28.25 0 45.75 18.5 46 42.75zM384 262v142h-82.25v-132.5c0-33.25-12-56-41.75-56-22.75 0-36.25 15.25-42.25 30-2 5.5-2.75 12.75-2.75 20.25v138.25h-82.25c1-224.5 0-247.75 0-247.75h82.25v36h-0.5c10.75-17 30.25-41.75 74.75-41.75 54.25 0 94.75 35.5 94.75 111.5z"></path></svg></button><button tabindex="0" role="button" class="react-share__ShareButton MuiButtonBase-root Post-shareButton css-hkx3jt"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-q7mezt" focusable="false" aria-hidden="true" viewBox="0 0 448 448"><path d="M297.25 326.75l36.75-173.25c3.25-15.25-5.5-21.25-15.5-17.5l-216 83.25c-14.75 5.75-14.5 14-2.5 17.75l55.25 17.25 128.25-80.75c6-4 11.5-1.75 7 2.25l-103.75 93.75-4 57c5.75 0 8.25-2.5 11.25-5.5l27-26 56 41.25c10.25 5.75 17.5 2.75 20.25-9.5zM448 224c0 123.75-100.25 224-224 224s-224-100.25-224-224 100.25-224 224-224 224 100.25 224 224z"></path></svg></button></div></div><div class="MuiBox-root css-1ebprri"><div class="MuiGrid-root MuiGrid-container MuiGrid-wrap-xs-nowrap MuiGrid-direction-xs-row css-hibhi5"><div class="MuiGrid-root MuiGrid-direction-xs-row css-1n5khr6"><a class="MuiTypography-root MuiTypography-h6 MuiLink-root MuiLink-underlineAlways css-1ubjslf" rel="prev" href="/2019/10/fix-gatsby-link-active-class/">← <!-- -->临时解决 Gatsby 中文链接 activeClass 无效问题</a></div><div class="MuiGrid-root MuiGrid-direction-xs-row Pagination-nextNav css-1n5khr6"><a class="MuiTypography-root MuiTypography-h6 MuiLink-root MuiLink-underlineAlways css-1ubjslf" rel="next" href="/2019/11/red-dead-redemption2-our-era-has-gone/">荒野大镖客2——我们的时代已过去是悲凉的事实<!-- --> →</a></div></div></div><div><div id="disqus_thread"></div></div></div><div class="MuiGrid-root MuiGrid-direction-xs-row MuiGrid-grid-xs-12 MuiGrid-grid-md-4 css-20tnkx"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-row MuiGrid-spacing-xs-4 css-199nrdm"><div class="MuiGrid-root MuiGrid-direction-xs-row MuiGrid-grid-xs-12 MuiGrid-grid-sm-6 MuiGrid-grid-md-12 css-fhbwnz"><div class="MuiBox-root css-0"><div class="MuiBox-root css-18b9ajk"><h6 class="MuiTypography-root MuiTypography-subtitle1 css-penf9g">分类</h6><a class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall css-xz9haa" tabindex="0" aria-label="more" title="全部" href="/categories/"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-q7mezt" focusable="false" aria-hidden="true" viewBox="0 0 24 24"><path d="M6 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2"></path></svg></a></div><a class="MuiTypography-root MuiTypography-body1 MuiTypography-noWrap MuiLink-root MuiLink-underlineNone Categories-link css-15zfxqh" href="/category/信息安全/">信息安全 (4)</a><a class="MuiTypography-root MuiTypography-body1 MuiTypography-noWrap MuiLink-root MuiLink-underlineNone Categories-link css-15zfxqh" href="/category/前端/">前端 (18)</a><a class="MuiTypography-root MuiTypography-body1 MuiTypography-noWrap MuiLink-root MuiLink-underlineNone Categories-link css-15zfxqh" href="/category/小玩意/">小玩意 (13)</a><a class="MuiTypography-root MuiTypography-body1 MuiTypography-noWrap MuiLink-root MuiLink-underlineNone Categories-link css-15zfxqh" href="/category/旅行/">旅行 (2)</a><a class="MuiTypography-root MuiTypography-body1 MuiTypography-noWrap MuiLink-root MuiLink-underlineNone Categories-link css-15zfxqh" href="/category/短片/">短片 (8)</a><a class="MuiTypography-root MuiTypography-body1 MuiTypography-noWrap MuiLink-root MuiLink-underlineNone Categories-link css-15zfxqh" href="/category/观点/">观点 (13)</a><a class="MuiTypography-root MuiTypography-body1 MuiTypography-noWrap MuiLink-root MuiLink-underlineNone Categories-link css-15zfxqh" href="/category/读书/">读书 (1)</a><a class="MuiTypography-root MuiTypography-body1 MuiTypography-noWrap MuiLink-root MuiLink-underlineNone Categories-link css-15zfxqh" href="/category/音乐/">音乐 (2)</a></div></div><div class="MuiGrid-root MuiGrid-direction-xs-row MuiGrid-grid-xs-12 MuiGrid-grid-sm-6 MuiGrid-grid-md-12 css-fhbwnz"><div class="MuiBox-root css-0"><div class="MuiBox-root css-18b9ajk"><h6 class="MuiTypography-root MuiTypography-subtitle1 css-penf9g">随机标签</h6><a class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall css-xz9haa" tabindex="0" aria-label="more" title="全部" href="/tags/"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-q7mezt" focusable="false" aria-hidden="true" viewBox="0 0 24 24"><path d="M6 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2"></path></svg></a></div><div class="MuiBox-root css-tzdv1b"><a class="MuiTypography-root MuiTypography-body1 MuiTypography-noWrap MuiLink-root MuiLink-underlineNone Tags-tagLink css-16d0jw" href="/tag/autocrasy/">autocrasy</a><a class="MuiTypography-root MuiTypography-body1 MuiTypography-noWrap MuiLink-root MuiLink-underlineNone Tags-tagLink css-16d0jw" href="/tag/family/">Family</a><a class="MuiTypography-root MuiTypography-body1 MuiTypography-noWrap MuiLink-root MuiLink-underlineNone Tags-tagLink css-16d0jw" href="/tag/pc/">PC</a><a class="MuiTypography-root MuiTypography-body1 MuiTypography-noWrap MuiLink-root MuiLink-underlineNone Tags-tagLink css-16d0jw" href="/tag/hasura/">Hasura</a><a class="MuiTypography-root MuiTypography-body1 MuiTypography-noWrap MuiLink-root MuiLink-underlineNone Tags-tagLink css-16d0jw" href="/tag/古墓丽影/">古墓丽影</a><a class="MuiTypography-root MuiTypography-body1 MuiTypography-noWrap MuiLink-root MuiLink-underlineNone Tags-tagLink css-16d0jw" href="/tag/地狱之刃/">地狱之刃</a><a class="MuiTypography-root MuiTypography-body1 MuiTypography-noWrap MuiLink-root MuiLink-underlineNone Tags-tagLink css-16d0jw" href="/tag/体育/">体育</a><a class="MuiTypography-root MuiTypography-body1 MuiTypography-noWrap MuiLink-root MuiLink-underlineNone Tags-tagLink css-16d0jw" href="/tag/节日/">节日</a><a class="MuiTypography-root MuiTypography-body1 MuiTypography-noWrap MuiLink-root MuiLink-underlineNone Tags-tagLink css-16d0jw" href="/tag/deep-stream/">DeepStream</a><a class="MuiTypography-root MuiTypography-body1 MuiTypography-noWrap MuiLink-root MuiLink-underlineNone Tags-tagLink css-16d0jw" href="/tag/公钥加密/">公钥加密</a><a class="MuiTypography-root MuiTypography-body1 MuiTypography-noWrap MuiLink-root MuiLink-underlineNone Tags-tagLink css-16d0jw" href="/tag/荒野大镖客/">荒野大镖客</a><a class="MuiTypography-root MuiTypography-body1 MuiTypography-noWrap MuiLink-root MuiLink-underlineNone Tags-tagLink css-16d0jw" href="/tag/bios/">BIOS</a><a class="MuiTypography-root MuiTypography-body1 MuiTypography-noWrap MuiLink-root MuiLink-underlineNone Tags-tagLink css-16d0jw" href="/tag/diary/">diary</a><a class="MuiTypography-root MuiTypography-body1 MuiTypography-noWrap MuiLink-root MuiLink-underlineNone Tags-tagLink css-16d0jw" href="/tag/apollo/">Apollo</a><a class="MuiTypography-root MuiTypography-body1 MuiTypography-noWrap MuiLink-root MuiLink-underlineNone Tags-tagLink css-16d0jw" href="/tag/物价/">物价</a><a class="MuiTypography-root MuiTypography-body1 MuiTypography-noWrap MuiLink-root MuiLink-underlineNone Tags-tagLink css-16d0jw" href="/tag/镜头/">镜头</a><a class="MuiTypography-root MuiTypography-body1 MuiTypography-noWrap MuiLink-root MuiLink-underlineNone Tags-tagLink css-16d0jw" href="/tag/gatsby/">Gatsby</a><a class="MuiTypography-root MuiTypography-body1 MuiTypography-noWrap MuiLink-root MuiLink-underlineNone Tags-tagLink css-16d0jw" href="/tag/翻译/">翻译</a><a class="MuiTypography-root MuiTypography-body1 MuiTypography-noWrap MuiLink-root MuiLink-underlineNone Tags-tagLink css-16d0jw" href="/tag/潜江/">潜江</a><a class="MuiTypography-root MuiTypography-body1 MuiTypography-noWrap MuiLink-root MuiLink-underlineNone Tags-tagLink css-16d0jw" href="/tag/web-sockets/">WebSockets</a></div></div></div></div></div></div><footer style="background-color:#fff;margin-top:48px"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-row MuiGrid-spacing-xs-3 css-177xvbk"><div class="MuiGrid-root MuiGrid-direction-xs-row MuiGrid-grid-md-4 css-1rfyg05"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineAlways css-18q3puk" href="/page/">文章</a>|<a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineAlways css-18q3puk" href="https://www.awildpetcat.com/" target="_blank" rel="noopener">自由的家猫</a>|<a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineAlways css-18q3puk" href="https://museum.berlinchan.com/" target="_blank" rel="noopener">旧站博物馆</a>|<a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineAlways css-18q3puk" href="/pages/about/">关于</a></div><div class="MuiGrid-root MuiGrid-direction-xs-row MuiGrid-grid-sm-6 MuiGrid-grid-md-4 css-1pdhekk"><a class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeLarge css-deih4v" tabindex="0" href="https://www.x.com/BerlinChanCom" target="_blank" rel="noopener"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-q7mezt" focusable="false" aria-hidden="true" viewBox="0 0 1200 1227"><path d="M714.163 519.284L1160.89 0H1055.03L667.137 450.887L357.328 0H0L468.492 681.821L0 1226.37H105.866L515.491 750.218L842.672 1226.37H1200L714.137 519.284H714.163ZM569.165 687.828L521.697 619.934L144.011 79.6944H306.615L611.412 515.685L658.88 583.579L1055.08 1150.3H892.476L569.165 687.854V687.828Z"></path></svg></a><a class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeLarge css-deih4v" tabindex="0" href="https://www.youtube.com/user/berlinchancom" target="_blank" rel="noopener"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-q7mezt" focusable="false" aria-hidden="true" viewBox="0 0 448 448"><path d="M177.75 282l121-62.5-121-63.25v125.75zM224 66.5c94.25 0 156.75 4.5 156.75 4.5 8.75 1 28 1 45 19 0 0 13.75 13.5 17.75 44.5 4.75 36.25 4.5 72.5 4.5 72.5v34s0.25 36.25-4.5 72.5c-4 30.75-17.75 44.5-17.75 44.5-17 17.75-36.25 17.75-45 18.75 0 0-62.5 4.75-156.75 4.75v0c-116.5-1-152.25-4.5-152.25-4.5-10-1.75-32.5-1.25-49.5-19 0 0-13.75-13.75-17.75-44.5-4.75-36.25-4.5-72.5-4.5-72.5v-34s-0.25-36.25 4.5-72.5c4-31 17.75-44.5 17.75-44.5 17-18 36.25-18 45-19 0 0 62.5-4.5 156.75-4.5v0z"></path></svg></a><a class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeLarge css-deih4v" tabindex="0" href="https://www.facebook.com/berlinchancom" target="_blank" rel="noopener"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-q7mezt" focusable="false" aria-hidden="true" viewBox="0 0 263 448"><path d="M239.75 3v66h-39.25c-30.75 0-36.5 14.75-36.5 36v47.25h73.25l-9.75 74h-63.5v189.75h-76.5v-189.75h-63.75v-74h63.75v-54.5c0-63.25 38.75-97.75 95.25-97.75 27 0 50.25 2 57 3z"></path></svg></a><a class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeLarge css-deih4v" tabindex="0" href="https://www.linkedin.com/in/berlinchan" target="_blank" rel="noopener"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-q7mezt" focusable="false" aria-hidden="true" viewBox="0 0 384 448"><path d="M87.25 156.25v247.75h-82.5v-247.75h82.5zM92.5 79.75c0.25 23.75-17.75 42.75-46.5 42.75v0h-0.5c-27.75 0-45.5-19-45.5-42.75 0-24.25 18.5-42.75 46.5-42.75 28.25 0 45.75 18.5 46 42.75zM384 262v142h-82.25v-132.5c0-33.25-12-56-41.75-56-22.75 0-36.25 15.25-42.25 30-2 5.5-2.75 12.75-2.75 20.25v138.25h-82.25c1-224.5 0-247.75 0-247.75h82.25v36h-0.5c10.75-17 30.25-41.75 74.75-41.75 54.25 0 94.75 35.5 94.75 111.5z"></path></svg></a><a class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeLarge css-deih4v" tabindex="0" href="https://github.com/BerlinChan" target="_blank" rel="noopener"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-q7mezt" focusable="false" aria-hidden="true" viewBox="0 0 384 448"><path d="M192 32c106 0 192 86 192 192 0 84.75-55 156.75-131.25 182.25-9.75 1.75-13.25-4.25-13.25-9.25 0-6.25 0.25-27 0.25-52.75 0-18-6-29.5-13-35.5 42.75-4.75 87.75-21 87.75-94.75 0-21-7.5-38-19.75-51.5 2-5 8.5-24.5-2-51-16-5-52.75 19.75-52.75 19.75-15.25-4.25-31.75-6.5-48-6.5s-32.75 2.25-48 6.5c0 0-36.75-24.75-52.75-19.75-10.5 26.5-4 46-2 51-12.25 13.5-19.75 30.5-19.75 51.5 0 73.5 44.75 90 87.5 94.75-5.5 5-10.5 13.5-12.25 25.75-11 5-39 13.5-55.75-16-10.5-18.25-29.5-19.75-29.5-19.75-18.75-0.25-1.25 11.75-1.25 11.75 12.5 5.75 21.25 28 21.25 28 11.25 34.25 64.75 22.75 64.75 22.75 0 16 0.25 31 0.25 35.75 0 5-3.5 11-13.25 9.25-76.25-25.5-131.25-97.5-131.25-182.25 0-106 86-192 192-192zM72.75 307.75c0.5-1-0.25-2.25-1.75-3-1.5-0.5-2.75-0.25-3.25 0.5-0.5 1 0.25 2.25 1.75 3 1.25 0.75 2.75 0.5 3.25-0.5zM80.5 316.25c1-0.75 0.75-2.5-0.5-4-1.25-1.25-3-1.75-4-0.75-1 0.75-0.75 2.5 0.5 4 1.25 1.25 3 1.75 4 0.75zM88 327.5c1.25-1 1.25-3 0-4.75-1-1.75-3-2.5-4.25-1.5-1.25 0.75-1.25 2.75 0 4.5s3.25 2.5 4.25 1.75zM98.5 338c1-1 0.5-3.25-1-4.75-1.75-1.75-4-2-5-0.75-1.25 1-0.75 3.25 1 4.75 1.75 1.75 4 2 5 0.75zM112.75 344.25c0.5-1.5-1-3.25-3.25-4-2-0.5-4.25 0.25-4.75 1.75s1 3.25 3.25 3.75c2 0.75 4.25 0 4.75-1.5zM128.5 345.5c0-1.75-2-3-4.25-2.75-2.25 0-4 1.25-4 2.75 0 1.75 1.75 3 4.25 2.75 2.25 0 4-1.25 4-2.75zM143 343c-0.25-1.5-2.25-2.5-4.5-2.25-2.25 0.5-3.75 2-3.5 3.75 0.25 1.5 2.25 2.5 4.5 2s3.75-2 3.5-3.5z"></path></svg></a><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeLarge css-deih4v" tabindex="0" type="button"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-q7mezt" focusable="false" aria-hidden="true" viewBox="0 0 512 448"><path d="M145 115.25c0-13.75-9-22.75-22.75-22.75-13.5 0-27.25 9-27.25 22.75 0 13.5 13.75 22.5 27.25 22.5 13.75 0 22.75-9 22.75-22.5zM330.75 242c0-9-9-18-22.75-18-9 0-18 9-18 18 0 9.25 9 18.25 18 18.25 13.75 0 22.75-9 22.75-18.25zM271.75 115.25c0-13.75-9-22.75-22.5-22.75-13.75 0-27.25 9-27.25 22.75 0 13.5 13.5 22.5 27.25 22.5 13.5 0 22.5-9 22.5-22.5zM430.5 242c0-9-9.25-18-22.75-18-9 0-18 9-18 18 0 9.25 9 18.25 18 18.25 13.5 0 22.75-9 22.75-18.25zM364 142.75c-5.75-0.75-11.5-1-17.5-1-86 0-154 64.25-154 143.25 0 13.25 2 26 5.75 38-5.75 0.5-11.25 0.75-17 0.75-22.75 0-40.75-4.5-63.5-9l-63.25 31.75 18-54.5c-45.25-31.75-72.5-72.75-72.5-122.5 0-86.25 81.5-154 181.25-154 89 0 167.25 54.25 182.75 127.25zM512 283c0 40.75-27 77-63.5 104.25l13.75 45.25-49.75-27.25c-18.25 4.5-36.5 9.25-54.5 9.25-86.25 0-154-59-154-131.5s67.75-131.5 154-131.5c81.5 0 154 59 154 131.5z"></path></svg></button><a class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeLarge css-deih4v" tabindex="0" href="/rss.xml" target="_blank" rel="noopener"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-q7mezt" focusable="false" aria-hidden="true" viewBox="0 0 352 448"><path d="M96 336c0 26.5-21.5 48-48 48s-48-21.5-48-48 21.5-48 48-48 48 21.5 48 48zM224 366.75c0.25 4.5-1.25 8.75-4.25 12-3 3.5-7.25 5.25-11.75 5.25h-33.75c-8.25 0-15-6.25-15.75-14.5-7.25-76.25-67.75-136.75-144-144-8.25-0.75-14.5-7.5-14.5-15.75v-33.75c0-4.5 1.75-8.75 5.25-11.75 2.75-2.75 6.75-4.25 10.75-4.25h1.25c53.25 4.25 103.5 27.5 141.25 65.5 38 37.75 61.25 88 65.5 141.25zM352 367.25c0.25 4.25-1.25 8.5-4.5 11.75-3 3.25-7 5-11.5 5h-35.75c-8.5 0-15.5-6.5-16-15-8.25-145.25-124-261-269.25-269.5-8.5-0.5-15-7.5-15-15.75v-35.75c0-4.5 1.75-8.5 5-11.5 3-3 7-4.5 11-4.5h0.75c87.5 4.5 169.75 41.25 231.75 103.5 62.25 62 99 144.25 103.5 231.75z"></path></svg></a></div><div class="MuiGrid-root MuiGrid-direction-xs-row MuiGrid-grid-sm-6 MuiGrid-grid-md-4 css-14ecud3"><p class="MuiTypography-root MuiTypography-body2 css-2zp2ut">本站作品采用<a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineAlways css-18q3puk" href="http://creativecommons.org/licenses/by/4.0/" target="_blank" rel="noopener">知识共享署名 4.0 国际许可协议</a>进行许可。</p></div></div></footer></div><div role="presentation" style="transform:scale(0);visibility:hidden"><button class="MuiButtonBase-root MuiFab-root MuiFab-circular MuiFab-sizeMedium MuiFab-secondary MuiFab-root MuiFab-circular MuiFab-sizeMedium MuiFab-secondary css-osloyf" tabindex="0" type="button" aria-label="scroll back to top"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-q7mezt" focusable="false" aria-hidden="true" viewBox="0 0 24 24"><path d="M7.41 15.41 12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path></svg></button></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/2019/11/building-an-encrypted-messenger-with-javascript/";/*]]>*/</script><!-- slice-start id="_gatsby-scripts-1" -->
          <script
            id="gatsby-chunk-mapping"
          >
            window.___chunkMapping="{\"app\":[\"/app-c6865c9baaa9b5cfc3a0.js\"],\"component---cache-caches-gatsby-plugin-offline-app-shell-js\":[\"/component---cache-caches-gatsby-plugin-offline-app-shell-js-e3e858f0d162b82bb8c4.js\"],\"component---src-pages-index-js\":[\"/component---src-pages-index-js-7ed2988234035798db9f.js\"],\"component---src-templates-categories-list-template-js\":[\"/component---src-templates-categories-list-template-js-db12dcc24bdd4274414f.js\"],\"component---src-templates-category-template-js\":[\"/component---src-templates-category-template-js-e37b24751063f6224b3c.js\"],\"component---src-templates-not-found-template-js\":[\"/component---src-templates-not-found-template-js-a7555e37ec6b40539612.js\"],\"component---src-templates-page-template-js\":[\"/component---src-templates-page-template-js-03edb85a094858ff911b.js\"],\"component---src-templates-post-archived-blog-template-js\":[\"/component---src-templates-post-archived-blog-template-js-488843c3c3a0da09fec4.js\"],\"component---src-templates-post-list-archived-blog-template-js\":[\"/component---src-templates-post-list-archived-blog-template-js-3fc40d7e8e48d2ff218d.js\"],\"component---src-templates-post-list-template-js\":[\"/component---src-templates-post-list-template-js-a5b39a29aac492f9c516.js\"],\"component---src-templates-post-template-js\":[\"/component---src-templates-post-template-js-646d0b53ed135f844872.js\"],\"component---src-templates-tag-template-js\":[\"/component---src-templates-tag-template-js-433cf1fef78041ff2943.js\"],\"component---src-templates-tags-list-template-js\":[\"/component---src-templates-tags-list-template-js-582f9646257b410ed192.js\"]}";
          </script>
        <script>window.___webpackCompilationHash="e158bc8767acbe06329e";</script><script src="/webpack-runtime-9c24a38e3fda98fe719c.js" async></script><script src="/framework-0dfb2f11d03084e0e7cb.js" async></script><script src="/app-c6865c9baaa9b5cfc3a0.js" async></script><!-- slice-end id="_gatsby-scripts-1" --></body></html>